!function(t,i){if("function"==typeof define&&define.amd){var o=["lodash","jquery","khoaijs","khoaijs-pre-options","khoaijs-template","khoaijs-waiter","../dialog_button","../dialog"];require(o,i)}else i(t._,t.jQuery||t.$,t.Khoai,t.Khoai&&t.Khoai.PreOptions||t.PreOptions,t.Khoai&&t.Khoai.Template||t.Template,t.Khoai&&t.Khoai.Waiter||t.Waiter,t.Khoai&&t.Khoai.Ajax||t.Ajax,t.Khoai&&t.Khoai.DialogButton||t.DialogButton,t.Khoai&&t.Khoai.Dialog||t.Dialog)}(this,function(t,i,o,e,n,s,a,d,l){function h(t,i,o){return'<div class="modal-header '+(i.options.type?"bg-"+i.options.type:"")+'"><button type="button" class="close" onclick="'+o.close_func+'()"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+i.options.title+"</h4></div>"}function r(t,i,o){var e=i.getContent(),n=[];return this.options.padding||n.push("padding: 0px;"),n.push("overflow: "+this.options.overflow+";"),['<div class="modal-body" style="',n.join(" "),'">',e,"</div>"].join("")}function p(i,o,e){var n=[],s='<div class="modal-footer" style="text-align: '+this.options.buttons_align+';">',a='<span class="dialog-pending-info text-muted pull-'+("left"===this.options.buttons_align?"right":"left")+'">'+this.options.pending_info+"</span>&nbsp;&nbsp;";return t.each(o.buttons,function(t){n.push(t.render())}),s+=n.join("\n")+a,s+="</div>"}function c(t,i,o){var e={large:"lg",small:"sm"},n="",s=['<div class="modal fade" tabindex="-1" role="dialog" id="<%= dom_id %>" data-dialog-id="',i.id,'" data-draw="<%- draw %>">'];return e.hasOwnProperty(i.options.size)&&(n="modal-"+e[i.options.size]),s.push('<div class="modal-dialog ',this.options.classes," ",n,'">','<div class="modal-content">'),this.options.has_header&&s.push("@HEADER@"),s.push("@BODY@"),this.options.has_footer&&s.push("@FOOTER@"),s.push("</div></div></div>"),s.join("")}function u(t){return{backdrop:!t||"static",keyboard:!t}}function g(){var t,o=u(this.options.close_manual),e=this.getDialog(),n={};n.close_func=s.createFunc(function(){this.getDialog().close()}.bind(this),!0,"Modal: "+e.id+" >>> Header close button"),this.waiter_keys.push(n.close_func),t=this.render(n),i("body").append(t),_(this),i(this.getDOM()).modal(o)}function _(t){var o=i(t.getDOM());o.on("show.bs.modal",function(e){i(e.target).is(o)&&(m++,t.emitEvent("show"))}),o.on("shown.bs.modal",function(e){i(e.target).is(o)&&(i("body .modal-backdrop").last().attr("id","modal-backdrop_"+t.id),t.emitEvent("shown"))}),o.on("hide.bs.modal",function(e){i(e.target).is(o)&&t.emitEvent("hide")}),o.on("hidden.bs.modal",function(e){i(e.target).is(o)&&(t.emitEvent("hidden"),t.getDialog().close())})}function f(){var t=this.getDialog().isCloseable();i(this.getDOM()).find(".modal-header .close").toggleClass("hide",!t)}function b(){if(!i.fn.modal)throw new Error("Dialog Bootstrap template require Bootstrap Modal to work");this.type_prefix="template_dialog_bootstrap",n.call(this),this.options=e.get(d.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME),this.waiter_keys=[],this.setLayout(c),this.setSection("HEADER",h.bind(this)),this.setSection("BODY",r.bind(this)),this.setSection("FOOTER",p.bind(this)),this.mimic(["open","toggle_enable","close","hide","show","update_content"]),this.addListener("open",g.bind(this)),this.addListener("toggle_enable",f.bind(this)),this.addListener("close",function(){s.remove(this.waiter_keys),this.waiter_keys=[],this.getDOM().modal("hide"),this.getDOM().remove(),m=Math.max(0,--m),i("body").toggleClass("modal-open",m>0),m||i("body .modal-backdrop").remove(),i("#modal-backdrop_"+this.id).remove()}),this.addListener("hide",function(){this.getDOM().hide(),i("#modal-backdrop_"+this.id).hide()}),this.addListener("show",function(){this.getDOM().show(),i("#modal-backdrop_"+this.id).show()}),this.addListener("update_content",function(t){this.getDialog().isOpened()&&this.updateContent(t)})}o.util.defineConstant(d,{TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME:"Khoai.Dialog.Template.Bootstrap"}),e.define(d.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME,{has_header:!0,has_footer:!0,close_manual:!0,padding:!0,classes:"",overflow:"hidden",buttons_align:"right",pending_info:""});var m=0;o.util.inherit(b,n),o.util.defineConstant(b,"version","0.0.1"),b.prototype.getDOM=function(){var t=this._super.getDOM.call(this);return i(t)},b.prototype.getDialog=function(){return this.dataSource},b.prototype.updateContent=function(t){t||(t=this.getDialog().options.content),i(this.getDOM()).find(".modal-body").html(t)},b.prototype.updatePendingInfo=function(t){i(this.getDOM()).find(".dialog-pending-info").html(t)},n.register(l.TEMPLATE_TYPE,"Bootstrap",b)}),function(t,i){if("function"==typeof define&&define.amd){var o=["lodash","khoaijs","khoaijs-pre-options","khoaijs-template","khoaijs-waiter","../dialog_button","../dialog"];require(o,i)}else i(t._,t.Khoai,t.PreOptions,t.Template,t.Waiter,t.DialogButton,t.Dialog)}(this,function(t,i,o,e,n,s,a){function d(t,i,o){return i.options.icon?'<span class="<%= option.icon_class %>"><i class="<%= data_source.options.icon %>"></i></span>&nbsp;&nbsp;':""}function l(i,o,e){var n=t.clamp(o.options.size-1,0,4),s=t.times(3*n,t.constant("&nbsp;&nbsp;")).join(""),a="",d=[];return o.isVisible()||d.push("display: none"),a+='<button type="button" id="<%= dom_id %>" data-button-id="<%= data_source.id %>"',a+='data-draw="<%- draw %>" style="'+d.join("; ")+'"',a+='class="btn btn-<%= data_source.options.type %>" data-name="<%= data_source.options.name %>" ',a+='onclick="'+i.click_key+'()"',o.isEnable()||(a+=' disabled="disabled"'),a+=">",a+=s+"@ICON@@LABEL@"+s+"</button>"}function h(){this.type_prefix="template_dialog_button_bootstrap",e.call(this);var t=this;this.options=o.get(s.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME),this.setLayout(l),this.setSection("ICON",d.bind(this)),this.setSection("LABEL",'<span class="<%= option.label_class %>"><%= data_source.options.label %></span>'),this.click_key=n.createFunc(function(){t.getButton().click()}),this.mimic(["toggle","toggle_enable"]),this.addListener("toggle",function(t){this.getDOM().toggle(t.data)}),this.addListener("toggle_enable",function(t){t?this.getDOM().removeAttr("disabled"):this.getDOM().attr("disabled","disabled"),this.getDOM().prop("disabled",!t)})}i.util.defineConstant(s,{TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME:"Khoai.DialogButton.Template.Bootstrap"}),o.define(s.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME,{icon_class:"dialog_button_icon",label_class:"dialog_button_label"}),i.util.inherit(h,e),i.util.defineConstant(h,"version","0.0.1"),h.prototype.getDOM=function(){var t=this._super.getDOM.call(this);return jQuery(t)},h.prototype.getButton=function(){return this.dataSource},h.prototype.updateLabel=function(t){this.getDOM().find("."+this.options.label_class).html(t)},h.prototype.updateIcon=function(t){this.getDOM().find("."+this.options.icon_class).html('<i class="'+t+'"></i>')},e.register(s.TEMPLATE_TYPE,"Bootstrap",h)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb3RzdHJhcC5taW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJkZXBlbmRlbmNpZXMiLCJyZXF1aXJlIiwiXyIsImpRdWVyeSIsIiQiLCJLaG9haSIsIlByZU9wdGlvbnMiLCJUZW1wbGF0ZSIsIldhaXRlciIsIkFqYXgiLCJEaWFsb2dCdXR0b24iLCJEaWFsb2ciLCJ0aGlzIiwiX3NlY3Rpb25faGVhZGVyIiwic2VsZiIsImRpYWxvZyIsInJlbmRlcl9kYXRhIiwib3B0aW9ucyIsInR5cGUiLCJjbG9zZV9mdW5jIiwidGl0bGUiLCJfc2VjdGlvbl9ib2R5IiwiY29udGVudCIsImdldENvbnRlbnQiLCJib2R5X3N0eWxlcyIsInBhZGRpbmciLCJwdXNoIiwib3ZlcmZsb3ciLCJqb2luIiwiX3NlY3Rpb25fZm9vdGVyIiwiYnV0dG9ucyIsInRlbXBsYXRlIiwiYnV0dG9uc19hbGlnbiIsInBlbmRpbmdfaW5mbyIsImVhY2giLCJidXR0b24iLCJyZW5kZXIiLCJfbGF5b3V0Iiwic2l6ZV9jbGFzc19tYXAiLCJsYXJnZSIsInNtYWxsIiwic2l6ZSIsImxheW91dCIsImlkIiwiaGFzT3duUHJvcGVydHkiLCJjbGFzc2VzIiwiaGFzX2hlYWRlciIsImhhc19mb290ZXIiLCJnZXRNb2RhbE9wdGlvbiIsImNsb3NlX21hbnVhbCIsImJhY2tkcm9wIiwia2V5Ym9hcmQiLCJfb3Blbl9kaWFsb2ciLCJtb2RhbF9vcHRpb25zIiwiZ2V0RGlhbG9nIiwiZGF0YSIsImNyZWF0ZUZ1bmMiLCJjbG9zZSIsImJpbmQiLCJ3YWl0ZXJfa2V5cyIsImFwcGVuZCIsIl9zZXREaWFsb2dET01FdmVudHMiLCJnZXRET00iLCJtb2RhbCIsImluc3RhbmNlIiwiZG9tIiwib24iLCJldmVudCIsInRhcmdldCIsImlzIiwiZGlhbG9nX29wZW5pbmciLCJlbWl0RXZlbnQiLCJsYXN0IiwiYXR0ciIsInVwZGF0ZV9kaWFsb2dfY2xvc2Vfc3RhdHVzIiwiY2xvc2VhYmxlIiwiaXNDbG9zZWFibGUiLCJmaW5kIiwidG9nZ2xlQ2xhc3MiLCJCb290c3RyYXAiLCJmbiIsIkVycm9yIiwidHlwZV9wcmVmaXgiLCJjYWxsIiwiZ2V0IiwiVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUUiLCJzZXRMYXlvdXQiLCJzZXRTZWN0aW9uIiwibWltaWMiLCJhZGRMaXN0ZW5lciIsInJlbW92ZSIsIk1hdGgiLCJtYXgiLCJoaWRlIiwic2hvdyIsIm5ld19jb250ZW50IiwiaXNPcGVuZWQiLCJ1cGRhdGVDb250ZW50IiwidXRpbCIsImRlZmluZUNvbnN0YW50IiwiaW5oZXJpdCIsInByb3RvdHlwZSIsIl9zdXBlciIsImRhdGFTb3VyY2UiLCJodG1sIiwidXBkYXRlUGVuZGluZ0luZm8iLCJpbmZvIiwicmVnaXN0ZXIiLCJURU1QTEFURV9UWVBFIiwiX3NlY3Rpb25faWNvbiIsImRhdGFfc291cmNlIiwiaWNvbiIsImNsYW1wIiwicGFkZGluZ19zcGFjZSIsInRpbWVzIiwiY29uc3RhbnQiLCJzdHlsZSIsImlzVmlzaWJsZSIsImNsaWNrX2tleSIsImlzRW5hYmxlIiwiZ2V0QnV0dG9uIiwiY2xpY2siLCJub3RpY2VkX2RhdGEiLCJ0b2dnbGUiLCJyZW1vdmVBdHRyIiwicHJvcCIsImljb25fY2xhc3MiLCJsYWJlbF9jbGFzcyIsInVwZGF0ZUxhYmVsIiwibGFiZWwiLCJ1cGRhdGVJY29uIl0sIm1hcHBpbmdzIjoiQ0FBQyxTQUFVQSxFQUFNQyxHQUNiLEdBQXNCLGtCQUFYQyxTQUF5QkEsT0FBT0MsSUFBSyxDQUM1QyxHQUFJQyxJQUNBLFNBQ0EsU0FDQSxVQUNBLHNCQUNBLG1CQUNBLGlCQUNBLG1CQUNBLFlBRUpDLFNBQVFELEVBQWNILE9BRXRCQSxHQUNJRCxFQUFLTSxFQUNMTixFQUFLTyxRQUFVUCxFQUFLUSxFQUNwQlIsRUFBS1MsTUFDSlQsRUFBS1MsT0FBU1QsRUFBS1MsTUFBTUMsWUFBZVYsRUFBS1UsV0FDN0NWLEVBQUtTLE9BQVNULEVB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S0FBSyxJQUFNakUsS0FBS0ssUUFBUTZHLFlBQVl0QixLQUFLLGFBQWVPLEVBQU8sV0FJakZ4RyxFQUFTb0csU0FBU2pHLEVBQWFrRyxjQUFlLFlBQWE3QiIsImZpbGUiOiJib290c3RyYXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XHJcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY2llcyA9IFtcclxuICAgICAgICAgICAgJ2xvZGFzaCcsXHJcbiAgICAgICAgICAgICdqcXVlcnknLFxyXG4gICAgICAgICAgICAna2hvYWlqcycsXHJcbiAgICAgICAgICAgICdraG9haWpzLXByZS1vcHRpb25zJyxcclxuICAgICAgICAgICAgJ2tob2FpanMtdGVtcGxhdGUnLFxyXG4gICAgICAgICAgICAna2hvYWlqcy13YWl0ZXInLFxyXG4gICAgICAgICAgICAnLi4vZGlhbG9nX2J1dHRvbicsXHJcbiAgICAgICAgICAgICcuLi9kaWFsb2cnXHJcbiAgICAgICAgXTtcclxuICAgICAgICByZXF1aXJlKGRlcGVuZGVuY2llcywgZmFjdG9yeSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGZhY3RvcnkoXHJcbiAgICAgICAgICAgIHJvb3QuXyxcclxuICAgICAgICAgICAgcm9vdC5qUXVlcnkgfHwgcm9vdC4kLFxyXG4gICAgICAgICAgICByb290Lktob2FpLFxyXG4gICAgICAgICAgICAocm9vdC5LaG9haSAmJiByb290Lktob2FpLlByZU9wdGlvbnMpIHx8IHJvb3QuUHJlT3B0aW9ucyxcclxuICAgICAgICAgICAgKHJvb3QuS2hvYWkgJiYgcm9vdC5LaG9haS5UZW1wbGF0ZSkgfHwgcm9vdC5UZW1wbGF0ZSxcclxuICAgICAgICAgICAgKHJvb3QuS2hvYWkgJiYgcm9vdC5LaG9haS5XYWl0ZXIpIHx8IHJvb3QuV2FpdGVyLFxyXG4gICAgICAgICAgICAocm9vdC5LaG9haSAmJiByb290Lktob2FpLkFqYXgpIHx8IHJvb3QuQWpheCxcclxuICAgICAgICAgICAgKHJvb3QuS2hvYWkgJiYgcm9vdC5LaG9haS5EaWFsb2dCdXR0b24pIHx8IHJvb3QuRGlhbG9nQnV0dG9uLFxyXG4gICAgICAgICAgICAocm9vdC5LaG9haSAmJiByb290Lktob2FpLkRpYWxvZykgfHwgcm9vdC5EaWFsb2dcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59KHRoaXMsIGZ1bmN0aW9uIChfLCBqUXVlcnksIEtob2FpLCBQcmVPcHRpb25zLCBUZW1wbGF0ZSwgV2FpdGVyLCBBamF4LCBEaWFsb2dCdXR0b24sIERpYWxvZykge1xyXG4gICAgdmFyIHZlcnNpb24gPSAnMC4wLjEnO1xyXG5cclxuICAgIEtob2FpLnV0aWwuZGVmaW5lQ29uc3RhbnQoRGlhbG9nQnV0dG9uLCB7XHJcbiAgICAgICAgVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUU6ICdLaG9haS5EaWFsb2cuVGVtcGxhdGUuQm9vdHN0cmFwJ1xyXG4gICAgfSk7XHJcbiAgICBQcmVPcHRpb25zLmRlZmluZShEaWFsb2dCdXR0b24uVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUUsIHtcclxuICAgICAgICBoYXNfaGVhZGVyOiB0cnVlLFxyXG4gICAgICAgIGhhc19mb290ZXI6IHRydWUsXHJcbiAgICAgICAgY2xvc2VfbWFudWFsOiB0cnVlLFxyXG4gICAgICAgIHBhZGRpbmc6IHRydWUsXHJcbiAgICAgICAgY2xhc3NlczogJycsXHJcbiAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxyXG4gICAgICAgIGJ1dHRvbnNfYWxpZ246ICdyaWdodCcsXHJcbiAgICAgICAgcGVuZGluZ19pbmZvOiAnJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgdmFyIGRpYWxvZ19vcGVuaW5nID0gMDtcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gX3NlY3Rpb25faGVhZGVyKHNlbGYsIGRpYWxvZywgcmVuZGVyX2RhdGEpIHtcclxuICAgICAgICB2YXIgaGVhZGVyX2NvbG9yID0gZGlhbG9nLm9wdGlvbnMudHlwZSA/ICdiZy0nICsgZGlhbG9nLm9wdGlvbnMudHlwZSA6ICcnO1xyXG5cclxuICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXIgJyArIGhlYWRlcl9jb2xvciArICdcIj4nICtcclxuICAgICAgICAgICAgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiY2xvc2VcIiBvbmNsaWNrPVwiJyArIHJlbmRlcl9kYXRhLmNsb3NlX2Z1bmMgKyAnKClcIj48c3BhbiBhcmlhLWhpZGRlbj1cInRydWVcIj4mdGltZXM7PC9zcGFuPjwvYnV0dG9uPicgK1xyXG4gICAgICAgICAgICAnPGg0IGNsYXNzPVwibW9kYWwtdGl0bGVcIj4nICsgZGlhbG9nLm9wdGlvbnMudGl0bGUgKyAnPC9oND4nICtcclxuICAgICAgICAgICAgJzwvZGl2Pic7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gX3NlY3Rpb25fYm9keShzZWxmLCBkaWFsb2csIHJlbmRlcl9kYXRhKSB7XHJcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBkaWFsb2cuZ2V0Q29udGVudCgpO1xyXG4gICAgICAgIHZhciBib2R5X3N0eWxlcyA9IFtdO1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5wYWRkaW5nKSB7XHJcbiAgICAgICAgICAgIGJvZHlfc3R5bGVzLnB1c2goJ3BhZGRpbmc6IDBweDsnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYm9keV9zdHlsZXMucHVzaCgnb3ZlcmZsb3c6ICcgKyB0aGlzLm9wdGlvbnMub3ZlcmZsb3cgKyAnOycpO1xyXG5cclxuICAgICAgICByZXR1cm4gWyc8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiIHN0eWxlPVwiJywgYm9keV9zdHlsZXMuam9pbignICcpLCAnXCI+JywgY29udGVudCwgJzwvZGl2PiddLmpvaW4oJycpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIF9zZWN0aW9uX2Zvb3RlcihzZWxmLCBkaWFsb2csIHJlbmRlcl9kYXRhKSB7XHJcbiAgICAgICAgdmFyIGJ1dHRvbnMgPSBbXTtcclxuICAgICAgICB2YXIgdGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiIHN0eWxlPVwidGV4dC1hbGlnbjogJyArIHRoaXMub3B0aW9ucy5idXR0b25zX2FsaWduICsgJztcIj4nO1xyXG4gICAgICAgIHZhciBwZW5kaW5nX2luZm8gPSAnPHNwYW4gY2xhc3M9XCJkaWFsb2ctcGVuZGluZy1pbmZvIHRleHQtbXV0ZWQgcHVsbC0nICsgKHRoaXMub3B0aW9ucy5idXR0b25zX2FsaWduID09PSAnbGVmdCcgPyAncmlnaHQnIDogJ2xlZnQnKSArICdcIj4nICsgdGhpcy5vcHRpb25zLnBlbmRpbmdfaW5mbyArICc8L3NwYW4+Jm5ic3A7Jm5ic3A7JztcclxuXHJcbiAgICAgICAgXy5lYWNoKGRpYWxvZy5idXR0b25zLCBmdW5jdGlvbiAoYnV0dG9uKSB7XHJcbiAgICAgICAgICAgIGJ1dHRvbnMucHVzaChidXR0b24ucmVuZGVyKCkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0ZW1wbGF0ZSArPSBidXR0b25zLmpvaW4oXCJcXG5cIikgKyBwZW5kaW5nX2luZm87XHJcbiAgICAgICAgdGVtcGxhdGUgKz0gJzwvZGl2Pic7XHJcblxyXG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBfbGF5b3V0KHNlbGYsIGRpYWxvZywgcmVuZGVyX2RhdGEpIHtcclxuICAgICAgICB2YXIgc2l6ZV9jbGFzc19tYXAgPSB7bGFyZ2U6ICdsZycsIHNtYWxsOiAnc20nfTtcclxuICAgICAgICB2YXIgc2l6ZSA9ICcnO1xyXG4gICAgICAgIHZhciBsYXlvdXQgPSBbJzxkaXYgY2xhc3M9XCJtb2RhbCBmYWRlXCIgdGFiaW5kZXg9XCItMVwiIHJvbGU9XCJkaWFsb2dcIiBpZD1cIjwlPSBkb21faWQgJT5cIiBkYXRhLWRpYWxvZy1pZD1cIicsIGRpYWxvZy5pZCwgJ1wiIGRhdGEtZHJhdz1cIjwlLSBkcmF3ICU+XCI+J107XHJcblxyXG5cclxuICAgICAgICBpZiAoc2l6ZV9jbGFzc19tYXAuaGFzT3duUHJvcGVydHkoZGlhbG9nLm9wdGlvbnMuc2l6ZSkpIHtcclxuICAgICAgICAgICAgc2l6ZSA9ICdtb2RhbC0nICsgc2l6ZV9jbGFzc19tYXBbZGlhbG9nLm9wdGlvbnMuc2l6ZV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsYXlvdXQucHVzaCgnPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZyAnLCB0aGlzLm9wdGlvbnMuY2xhc3NlcywgJyAnLCBzaXplLCAnXCI+JywgJzxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCI+Jyk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGFzX2hlYWRlcikge1xyXG4gICAgICAgICAgICBsYXlvdXQucHVzaCgnQEhFQURFUkAnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxheW91dC5wdXNoKCdAQk9EWUAnKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oYXNfZm9vdGVyKSB7XHJcbiAgICAgICAgICAgIGxheW91dC5wdXNoKCdARk9PVEVSQCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGF5b3V0LnB1c2goJzwvZGl2PjwvZGl2PjwvZGl2PicpO1xyXG5cclxuICAgICAgICByZXR1cm4gbGF5b3V0LmpvaW4oJycpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldE1vZGFsT3B0aW9uKGNsb3NlX21hbnVhbCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGJhY2tkcm9wOiBjbG9zZV9tYW51YWwgPyAnc3RhdGljJyA6IHRydWUsXHJcbiAgICAgICAgICAgIGtleWJvYXJkOiAhY2xvc2VfbWFudWFsXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIF9vcGVuX2RpYWxvZygpIHtcclxuICAgICAgICB2YXIgbW9kYWxfb3B0aW9ucyA9IGdldE1vZGFsT3B0aW9uKHRoaXMub3B0aW9ucy5jbG9zZV9tYW51YWwpLFxyXG4gICAgICAgICAgICBkaWFsb2cgPSB0aGlzLmdldERpYWxvZygpLFxyXG4gICAgICAgICAgICBkYXRhID0ge30sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlO1xyXG5cclxuICAgICAgICBkYXRhWydjbG9zZV9mdW5jJ10gPSBXYWl0ZXIuY3JlYXRlRnVuYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0RGlhbG9nKCkuY2xvc2UoKTtcclxuICAgICAgICB9LmJpbmQodGhpcyksIHRydWUsICdNb2RhbDogJyArIGRpYWxvZy5pZCArICcgPj4+IEhlYWRlciBjbG9zZSBidXR0b24nKTtcclxuXHJcbiAgICAgICAgdGhpcy53YWl0ZXJfa2V5cy5wdXNoKGRhdGFbJ2Nsb3NlX2Z1bmMnXSk7XHJcblxyXG4gICAgICAgIHRlbXBsYXRlID0gdGhpcy5yZW5kZXIoZGF0YSk7XHJcblxyXG4gICAgICAgIGpRdWVyeSgnYm9keScpLmFwcGVuZCh0ZW1wbGF0ZSk7XHJcbiAgICAgICAgX3NldERpYWxvZ0RPTUV2ZW50cyh0aGlzKTtcclxuICAgICAgICBqUXVlcnkodGhpcy5nZXRET00oKSkubW9kYWwobW9kYWxfb3B0aW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gX3NldERpYWxvZ0RPTUV2ZW50cyhpbnN0YW5jZSkge1xyXG4gICAgICAgIHZhciBkb20gPSBqUXVlcnkoaW5zdGFuY2UuZ2V0RE9NKCkpO1xyXG5cclxuICAgICAgICBkb20ub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGpRdWVyeShldmVudC50YXJnZXQpLmlzKGRvbSkpIHtcclxuICAgICAgICAgICAgICAgIGRpYWxvZ19vcGVuaW5nKys7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5lbWl0RXZlbnQoJ3Nob3cnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkb20ub24oJ3Nob3duLmJzLm1vZGFsJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChqUXVlcnkoZXZlbnQudGFyZ2V0KS5pcyhkb20pKSB7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoJ2JvZHkgLm1vZGFsLWJhY2tkcm9wJykubGFzdCgpLmF0dHIoJ2lkJywgJ21vZGFsLWJhY2tkcm9wXycgKyBpbnN0YW5jZS5pZCk7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5lbWl0RXZlbnQoJ3Nob3duJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZG9tLm9uKCdoaWRlLmJzLm1vZGFsJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChqUXVlcnkoZXZlbnQudGFyZ2V0KS5pcyhkb20pKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5lbWl0RXZlbnQoJ2hpZGUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkb20ub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoalF1ZXJ5KGV2ZW50LnRhcmdldCkuaXMoZG9tKSkge1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZW1pdEV2ZW50KCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmdldERpYWxvZygpLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVfZGlhbG9nX2Nsb3NlX3N0YXR1cygpIHtcclxuICAgICAgICB2YXIgY2xvc2VhYmxlID0gdGhpcy5nZXREaWFsb2coKS5pc0Nsb3NlYWJsZSgpO1xyXG4gICAgICAgIHZhciBtb2RhbF9kb20gPSBqUXVlcnkodGhpcy5nZXRET00oKSk7XHJcblxyXG4gICAgICAgIG1vZGFsX2RvbS5maW5kKCcubW9kYWwtaGVhZGVyIC5jbG9zZScpLnRvZ2dsZUNsYXNzKCdoaWRlJywgIWNsb3NlYWJsZSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIEJvb3RzdHJhcCgpIHtcclxuICAgICAgICBpZiAoIWpRdWVyeS5mbi5tb2RhbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RpYWxvZyBCb290c3RyYXAgdGVtcGxhdGUgcmVxdWlyZSBCb290c3RyYXAgTW9kYWwgdG8gd29yaycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy50eXBlX3ByZWZpeCA9ICd0ZW1wbGF0ZV9kaWFsb2dfYm9vdHN0cmFwJztcclxuXHJcbiAgICAgICAgVGVtcGxhdGUuY2FsbCh0aGlzKTtcclxuXHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gUHJlT3B0aW9ucy5nZXQoRGlhbG9nQnV0dG9uLlRFTVBMQVRFX0JPT1RTVFJBUF9QUkVfT1BUSU9OU19OQU1FKTtcclxuXHJcbiAgICAgICAgdGhpcy53YWl0ZXJfa2V5cyA9IFtdO1xyXG4gICAgICAgIHRoaXMuc2V0TGF5b3V0KF9sYXlvdXQpO1xyXG4gICAgICAgIHRoaXMuc2V0U2VjdGlvbignSEVBREVSJywgX3NlY3Rpb25faGVhZGVyLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuc2V0U2VjdGlvbignQk9EWScsIF9zZWN0aW9uX2JvZHkuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdGT09URVInLCBfc2VjdGlvbl9mb290ZXIuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgICAgIHRoaXMubWltaWMoWydvcGVuJywgJ3RvZ2dsZV9lbmFibGUnLCAnY2xvc2UnLCAnaGlkZScsICdzaG93JywgJ3VwZGF0ZV9jb250ZW50J10pO1xyXG5cclxuICAgICAgICB0aGlzLmFkZExpc3RlbmVyKCdvcGVuJywgX29wZW5fZGlhbG9nLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3RvZ2dsZV9lbmFibGUnLCB1cGRhdGVfZGlhbG9nX2Nsb3NlX3N0YXR1cy5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLmFkZExpc3RlbmVyKCdjbG9zZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgV2FpdGVyLnJlbW92ZSh0aGlzLndhaXRlcl9rZXlzKTtcclxuICAgICAgICAgICAgdGhpcy53YWl0ZXJfa2V5cyA9IFtdO1xyXG4gICAgICAgICAgICB0aGlzLmdldERPTSgpLm1vZGFsKCdoaWRlJyk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkucmVtb3ZlKCk7XHJcblxyXG4gICAgICAgICAgICAvL0ZpeCBtb2RhbC1vcGVuIGNsYXNzIG9uIGJvZHlcclxuICAgICAgICAgICAgZGlhbG9nX29wZW5pbmcgPSBNYXRoLm1heCgwLCAtLWRpYWxvZ19vcGVuaW5nKTtcclxuICAgICAgICAgICAgalF1ZXJ5KCdib2R5JykudG9nZ2xlQ2xhc3MoJ21vZGFsLW9wZW4nLCBkaWFsb2dfb3BlbmluZyA+IDApO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFkaWFsb2dfb3BlbmluZykge1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KCdib2R5IC5tb2RhbC1iYWNrZHJvcCcpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGpRdWVyeSgnI21vZGFsLWJhY2tkcm9wXycgKyB0aGlzLmlkKS5yZW1vdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmFkZExpc3RlbmVyKCdoaWRlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLmdldERPTSgpLmhpZGUoKTtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjbW9kYWwtYmFja2Ryb3BfJyArIHRoaXMuaWQpLmhpZGUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmFkZExpc3RlbmVyKCdzaG93JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLmdldERPTSgpLnNob3coKTtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjbW9kYWwtYmFja2Ryb3BfJyArIHRoaXMuaWQpLnNob3coKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmFkZExpc3RlbmVyKCd1cGRhdGVfY29udGVudCcsIGZ1bmN0aW9uIChuZXdfY29udGVudCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5nZXREaWFsb2coKS5pc09wZW5lZCgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNvbnRlbnQobmV3X2NvbnRlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIEtob2FpLnV0aWwuaW5oZXJpdChCb290c3RyYXAsIFRlbXBsYXRlKTtcclxuICAgIEtob2FpLnV0aWwuZGVmaW5lQ29uc3RhbnQoQm9vdHN0cmFwLCAndmVyc2lvbicsIHZlcnNpb24pO1xyXG5cclxuICAgIEJvb3RzdHJhcC5wcm90b3R5cGUuZ2V0RE9NID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBkb20gPSB0aGlzLl9zdXBlci5nZXRET00uY2FsbCh0aGlzKTtcclxuICAgICAgICByZXR1cm4galF1ZXJ5KGRvbSk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIHtudWxsfCp8T2JqZWN0fEV2ZW50RW1pdHRlcnxEaWFsb2d9XHJcbiAgICAgKi9cclxuICAgIEJvb3RzdHJhcC5wcm90b3R5cGUuZ2V0RGlhbG9nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmRhdGFTb3VyY2U7XHJcbiAgICB9O1xyXG5cclxuICAgIEJvb3RzdHJhcC5wcm90b3R5cGUudXBkYXRlQ29udGVudCA9IGZ1bmN0aW9uIChuZXdfY29udGVudCkge1xyXG4gICAgICAgIGlmICghbmV3X2NvbnRlbnQpIHtcclxuICAgICAgICAgICAgbmV3X2NvbnRlbnQgPSB0aGlzLmdldERpYWxvZygpLm9wdGlvbnMuY29udGVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGpRdWVyeSh0aGlzLmdldERPTSgpKS5maW5kKCcubW9kYWwtYm9keScpLmh0bWwobmV3X2NvbnRlbnQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBCb290c3RyYXAucHJvdG90eXBlLnVwZGF0ZVBlbmRpbmdJbmZvID0gZnVuY3Rpb24gKGluZm8pIHtcclxuICAgICAgICBqUXVlcnkodGhpcy5nZXRET00oKSkuZmluZCgnLmRpYWxvZy1wZW5kaW5nLWluZm8nKS5odG1sKGluZm8pO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgVGVtcGxhdGUucmVnaXN0ZXIoRGlhbG9nLlRFTVBMQVRFX1RZUEUsICdCb290c3RyYXAnLCBCb290c3RyYXApO1xyXG59KSk7XG4oZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcclxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcclxuICAgICAgICB2YXIgZGVwZW5kZW5jaWVzID0gW1xyXG4gICAgICAgICAgICAnbG9kYXNoJyxcclxuICAgICAgICAgICAgJ2tob2FpanMnLFxyXG4gICAgICAgICAgICAna2hvYWlqcy1wcmUtb3B0aW9ucycsXHJcbiAgICAgICAgICAgICdraG9haWpzLXRlbXBsYXRlJyxcclxuICAgICAgICAgICAgJ2tob2FpanMtd2FpdGVyJyxcclxuICAgICAgICAgICAgJy4uL2RpYWxvZ19idXR0b24nLFxyXG4gICAgICAgICAgICAnLi4vZGlhbG9nJ1xyXG4gICAgICAgIF07XHJcbiAgICAgICAgcmVxdWlyZShkZXBlbmRlbmNpZXMsIGZhY3RvcnkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBmYWN0b3J5KHJvb3QuXywgcm9vdC5LaG9haSwgcm9vdC5QcmVPcHRpb25zLCByb290LlRlbXBsYXRlLCByb290LldhaXRlciwgcm9vdC5EaWFsb2dCdXR0b24sIHJvb3QuRGlhbG9nKTtcclxuICAgIH1cclxufSh0aGlzLCBmdW5jdGlvbiAoXywgS2hvYWksIFByZU9wdGlvbnMsIFRlbXBsYXRlLCBXYWl0ZXIsIERpYWxvZ0J1dHRvbiwgRGlhbG9nKSB7XHJcbiAgICB2YXIgdmVyc2lvbiA9ICcwLjAuMSc7XHJcblxyXG4gICAgS2hvYWkudXRpbC5kZWZpbmVDb25zdGFudChEaWFsb2dCdXR0b24sIHtcclxuICAgICAgICBURU1QTEFURV9CT09UU1RSQVBfUFJFX09QVElPTlNfTkFNRTogJ0tob2FpLkRpYWxvZ0J1dHRvbi5UZW1wbGF0ZS5Cb290c3RyYXAnXHJcbiAgICB9KTtcclxuXHJcbiAgICBQcmVPcHRpb25zLmRlZmluZShEaWFsb2dCdXR0b24uVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUUsIHtcclxuICAgICAgICBpY29uX2NsYXNzOiAnZGlhbG9nX2J1dHRvbl9pY29uJyxcclxuICAgICAgICBsYWJlbF9jbGFzczogJ2RpYWxvZ19idXR0b25fbGFiZWwnXHJcbiAgICB9KTtcclxuXHJcbiAgICBmdW5jdGlvbiBfc2VjdGlvbl9pY29uKGluc3RhbmNlLCBkYXRhX3NvdXJjZSwgZGF0YSkge1xyXG4gICAgICAgIGlmIChkYXRhX3NvdXJjZS5vcHRpb25zLmljb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cIjwlPSBvcHRpb24uaWNvbl9jbGFzcyAlPlwiPjxpIGNsYXNzPVwiPCU9IGRhdGFfc291cmNlLm9wdGlvbnMuaWNvbiAlPlwiPjwvaT48L3NwYW4+Jm5ic3A7Jm5ic3A7JztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIF9sYXlvdXQoaW5zdGFuY2UsIGRhdGFfc291cmNlLCBkYXRhKSB7XHJcbiAgICAgICAgdmFyIHNpemUgPSBfLmNsYW1wKGRhdGFfc291cmNlLm9wdGlvbnMuc2l6ZSAtIDEsIDAsIDQpLFxyXG4gICAgICAgICAgICBwYWRkaW5nX3NwYWNlID0gXy50aW1lcyhzaXplICogMywgXy5jb25zdGFudCgnJm5ic3A7Jm5ic3A7JykpLmpvaW4oJycpLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZSA9ICcnLFxyXG4gICAgICAgICAgICBzdHlsZSA9IFtdO1xyXG5cclxuICAgICAgICBpZiAoIWRhdGFfc291cmNlLmlzVmlzaWJsZSgpKSB7XHJcbiAgICAgICAgICAgIHN0eWxlLnB1c2goJ2Rpc3BsYXk6IG5vbmUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRlbXBsYXRlICs9ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cIjwlPSBkb21faWQgJT5cIiBkYXRhLWJ1dHRvbi1pZD1cIjwlPSBkYXRhX3NvdXJjZS5pZCAlPlwiJztcclxuICAgICAgICB0ZW1wbGF0ZSArPSAnZGF0YS1kcmF3PVwiPCUtIGRyYXcgJT5cIiBzdHlsZT1cIicgKyBzdHlsZS5qb2luKCc7ICcpICsgJ1wiJztcclxuICAgICAgICB0ZW1wbGF0ZSArPSAnY2xhc3M9XCJidG4gYnRuLTwlPSBkYXRhX3NvdXJjZS5vcHRpb25zLnR5cGUgJT5cIiBkYXRhLW5hbWU9XCI8JT0gZGF0YV9zb3VyY2Uub3B0aW9ucy5uYW1lICU+XCIgJztcclxuICAgICAgICB0ZW1wbGF0ZSArPSAnb25jbGljaz1cIicgKyBpbnN0YW5jZS5jbGlja19rZXkgKyAnKClcIic7XHJcblxyXG4gICAgICAgIGlmICghZGF0YV9zb3VyY2UuaXNFbmFibGUoKSkge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnIGRpc2FibGVkPVwiZGlzYWJsZWRcIic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0ZW1wbGF0ZSArPSAnPic7XHJcbiAgICAgICAgdGVtcGxhdGUgKz0gcGFkZGluZ19zcGFjZSArICdASUNPTkBATEFCRUxAJyArIHBhZGRpbmdfc3BhY2UgKyAnPC9idXR0b24+JztcclxuXHJcbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBCb290c3RyYXAoKSB7XHJcbiAgICAgICAgdGhpcy50eXBlX3ByZWZpeCA9ICd0ZW1wbGF0ZV9kaWFsb2dfYnV0dG9uX2Jvb3RzdHJhcCc7XHJcbiAgICAgICAgVGVtcGxhdGUuY2FsbCh0aGlzKTtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBQcmVPcHRpb25zLmdldChEaWFsb2dCdXR0b24uVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUUpO1xyXG5cclxuICAgICAgICB0aGlzLnNldExheW91dChfbGF5b3V0KTtcclxuICAgICAgICB0aGlzLnNldFNlY3Rpb24oJ0lDT04nLCBfc2VjdGlvbl9pY29uLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuc2V0U2VjdGlvbignTEFCRUwnLCAnPHNwYW4gY2xhc3M9XCI8JT0gb3B0aW9uLmxhYmVsX2NsYXNzICU+XCI+PCU9IGRhdGFfc291cmNlLm9wdGlvbnMubGFiZWwgJT48L3NwYW4+Jyk7XHJcblxyXG4gICAgICAgIHRoaXMuY2xpY2tfa2V5ID0gV2FpdGVyLmNyZWF0ZUZ1bmMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZWxmLmdldEJ1dHRvbigpLmNsaWNrKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMubWltaWMoWyd0b2dnbGUnLCAndG9nZ2xlX2VuYWJsZSddKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcigndG9nZ2xlJywgZnVuY3Rpb24gKG5vdGljZWRfZGF0YSkge1xyXG4gICAgICAgICAgICB0aGlzLmdldERPTSgpLnRvZ2dsZShub3RpY2VkX2RhdGEuZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcigndG9nZ2xlX2VuYWJsZScsIGZ1bmN0aW9uIChub3RpY2VkX2RhdGEpIHtcclxuICAgICAgICAgICAgaWYgKG5vdGljZWRfZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRET00oKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRET00oKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLmdldERPTSgpLnByb3AoJ2Rpc2FibGVkJywgIW5vdGljZWRfZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIEtob2FpLnV0aWwuaW5oZXJpdChCb290c3RyYXAsIFRlbXBsYXRlKTtcclxuICAgIEtob2FpLnV0aWwuZGVmaW5lQ29uc3RhbnQoQm9vdHN0cmFwLCAndmVyc2lvbicsIHZlcnNpb24pO1xyXG5cclxuICAgIEJvb3RzdHJhcC5wcm90b3R5cGUuZ2V0RE9NID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBkb20gPSB0aGlzLl9zdXBlci5nZXRET00uY2FsbCh0aGlzKTtcclxuICAgICAgICByZXR1cm4galF1ZXJ5KGRvbSk7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyB7bnVsbHwqfE9iamVjdHxFdmVudEVtaXR0ZXJ8RGlhbG9nfVxyXG4gICAgICovXHJcbiAgICBCb290c3RyYXAucHJvdG90eXBlLmdldEJ1dHRvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kYXRhU291cmNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBCb290c3RyYXAucHJvdG90eXBlLnVwZGF0ZUxhYmVsID0gZnVuY3Rpb24gKGxhYmVsKSB7XHJcbiAgICAgICAgdGhpcy5nZXRET00oKS5maW5kKCcuJyArIHRoaXMub3B0aW9ucy5sYWJlbF9jbGFzcykuaHRtbChsYWJlbCk7XHJcbiAgICB9O1xyXG5cclxuICAgIEJvb3RzdHJhcC5wcm90b3R5cGUudXBkYXRlSWNvbiA9IGZ1bmN0aW9uIChpY29uKSB7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0RE9NKCkuZmluZCgnLicgKyB0aGlzLm9wdGlvbnMuaWNvbl9jbGFzcykuaHRtbCgnPGkgY2xhc3M9XCInICsgaWNvbiArICdcIj48L2k+Jyk7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICBUZW1wbGF0ZS5yZWdpc3RlcihEaWFsb2dCdXR0b24uVEVNUExBVEVfVFlQRSwgJ0Jvb3RzdHJhcCcsIEJvb3RzdHJhcCk7XHJcbn0pKTsiXX0=
