!function(t,i){if("function"==typeof define&&define.amd){var o=["lodash","jquery","khoaijs","khoaijs-pre-options","khoaijs-template","khoaijs-waiter","../dialog"];require(o,i)}else i(t._,t.jQuery||t.$,t.Khoai,t.Khoai&&t.Khoai.PreOptions||t.PreOptions,t.Khoai&&t.Khoai.Template||t.Template,t.Khoai&&t.Khoai.Waiter||t.Waiter,t.Khoai&&t.Khoai.Dialog||t.Dialog)}(this,function(t,i,o,e,s,n,a){function d(t,i,o){return'<div class="modal-header '+(i.options.type?"bg-"+i.options.type:"")+'"><button type="button" class="close" onclick="'+o.close_func+'()"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+i.options.title+"</h4></div>"}function l(t,i,o){var e=i.getContent(),s=[];return this.options.padding||s.push("padding: 0px;"),s.push("overflow: "+this.options.overflow+";"),['<div class="modal-body" style="',s.join(" "),'">',e,"</div>"].join("")}function r(i,o,e){var s=[],n='<div class="modal-footer" style="text-align: '+this.options.buttons_align+';">',a='<span class="dialog-pending-info text-muted pull-'+("left"===this.options.buttons_align?"right":"left")+'">'+this.options.pending_info+"</span>&nbsp;&nbsp;";return t.each(o.buttons,function(t){s.push(t.render())}),n+=s.join("\n")+a,n+="</div>"}function h(t,i,o){var e={large:"lg",small:"sm"},s="",n=['<div class="modal fade" tabindex="-1" role="dialog" id="<%= dom_id %>" data-dialog-id="',i.id,'" data-draw="<%- draw %>">'];return e.hasOwnProperty(i.options.size)&&(s="modal-"+e[i.options.size]),n.push('<div class="modal-dialog ',this.options.classes," ",s,'">','<div class="modal-content">'),this.options.has_header&&n.push("@HEADER@"),n.push("@BODY@"),this.options.has_footer&&n.push("@FOOTER@"),n.push("</div></div></div>"),n.join("")}function p(t){return{backdrop:!t||"static",keyboard:!t}}function c(){var t,o=p(this.options.close_manual),e=this.getDialog(),s={};s.close_func=n.createFunc(function(){this.getDialog().close()}.bind(this),!0,"Modal: "+e.id+" >>> Header close button"),this.waiter_keys.push(s.close_func),t=this.render(s),i("body").append(t),u(this),i(this.getDOM()).modal(o)}function u(t){var o=i(t.getDOM());o.on("show.bs.modal",function(e){i(e.target).is(o)&&(f++,t.emitEvent("show"))}),o.on("shown.bs.modal",function(e){i(e.target).is(o)&&(i("body .modal-backdrop").last().attr("id","modal-backdrop_"+t.id),t.emitEvent("shown"))}),o.on("hide.bs.modal",function(e){i(e.target).is(o)&&t.emitEvent("hide")}),o.on("hidden.bs.modal",function(e){i(e.target).is(o)&&(t.emitEvent("hidden"),t.getDialog().close())})}function g(){var t=this.getDialog().isCloseable();i(this.getDOM()).find(".modal-header .close").toggleClass("hide",!t)}function _(){if(!i.fn.modal)throw new Error("Dialog Bootstrap template require Bootstrap Modal to work");this.type_prefix="template_dialog_bootstrap",s.call(this),this.options=e.get(a.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME),this.waiter_keys=[],this.setLayout(h),this.setSection("HEADER",d.bind(this)),this.setSection("BODY",l.bind(this)),this.setSection("FOOTER",r.bind(this)),this.mimic(["open","toggle_enable","close","hide","show","update_content"]),this.addListener("open",c.bind(this)),this.addListener("toggle_enable",g.bind(this)),this.addListener("close",function(){n.remove(this.waiter_keys),this.waiter_keys=[],this.getDOM().modal("hide"),this.getDOM().remove(),f=Math.max(0,--f),i("body").toggleClass("modal-open",f>0),f||i("body .modal-backdrop").remove(),i("#modal-backdrop_"+this.id).remove()}),this.addListener("hide",function(){this.getDOM().hide(),i("#modal-backdrop_"+this.id).hide()}),this.addListener("show",function(){this.getDOM().show(),i("#modal-backdrop_"+this.id).show()}),this.addListener("update_content",function(t){this.getDialog().isOpened()&&this.updateContent(t)})}o.util.defineConstant(a,{TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME:"Khoai.Dialog.Template.Bootstrap"}),e.define(a.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME,{has_header:!0,has_footer:!0,close_manual:!0,padding:!0,classes:"",overflow:"hidden",buttons_align:"right",pending_info:""});var f=0;o.util.inherit(_,s),o.util.defineConstant(_,"version","0.0.1"),_.prototype.getDOM=function(){var t=this._super.getDOM.call(this);return i(t)},_.prototype.getDialog=function(){return this.dataSource},_.prototype.updateContent=function(t){t||(t=this.getDialog().options.content),i(this.getDOM()).find(".modal-body").html(t)},_.prototype.updatePendingInfo=function(t){i(this.getDOM()).find(".dialog-pending-info").html(t)},s.register(a.TEMPLATE_TYPE,"Bootstrap",_)}),function(t,i){if("function"==typeof define&&define.amd){var o=["lodash","khoaijs","khoaijs-pre-options","khoaijs-template","khoaijs-waiter","../dialog_button"];require(o,i)}else i(t._,t.Khoai,t.PreOptions,t.Template,t.Waiter,t.DialogButton)}(this,function(t,i,o,e,s,n){function a(t,i,o){return i.options.icon?'<span class="<%= option.icon_class %>"><i class="<%= data_source.options.icon %>"></i></span>&nbsp;&nbsp;':""}function d(i,o,e){var s=t.clamp(o.options.size-1,0,4),n=t.times(3*s,t.constant("&nbsp;&nbsp;")).join(""),a="",d=[];return o.isVisible()||d.push("display: none"),a+='<button type="button" id="<%= dom_id %>" data-button-id="<%= data_source.id %>"',a+='data-draw="<%- draw %>" style="'+d.join("; ")+'"',a+='class="btn btn-<%= data_source.options.type %>" data-name="<%= data_source.options.name %>" ',a+='onclick="'+i.click_key+'()"',o.isEnable()||(a+=' disabled="disabled"'),a+=">",a+=n+"@ICON@@LABEL@"+n+"</button>"}function l(){this.type_prefix="template_dialog_button_bootstrap",e.call(this);var t=this;this.options=o.get(n.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME),this.setLayout(d),this.setSection("ICON",a.bind(this)),this.setSection("LABEL",'<span class="<%= option.label_class %>"><%= data_source.options.label %></span>'),this.click_key=s.createFunc(function(){t.getButton().click()}),this.mimic(["toggle","toggle_enable"]),this.addListener("toggle",function(t){this.getDOM().toggle(t.data)}),this.addListener("toggle_enable",function(t){t?this.getDOM().removeAttr("disabled"):this.getDOM().attr("disabled","disabled"),this.getDOM().prop("disabled",!t)})}i.util.defineConstant(n,{TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME:"Khoai.DialogButton.Template.Bootstrap"}),o.define(n.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME,{icon_class:"dialog_button_icon",label_class:"dialog_button_label"}),i.util.inherit(l,e),i.util.defineConstant(l,"version","0.0.1"),l.prototype.getDOM=function(){var t=this._super.getDOM.call(this);return jQuery(t)},l.prototype.getButton=function(){return this.dataSource},l.prototype.updateLabel=function(t){this.getDOM().find("."+this.options.label_class).html(t)},l.prototype.updateIcon=function(t){this.getDOM().find("."+this.options.icon_class).html('<i class="'+t+'"></i>')},e.register(n.TEMPLATE_TYPE,"Bootstrap",l)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb3RzdHJhcC5taW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJkZXBlbmRlbmNpZXMiLCJyZXF1aXJlIiwiXyIsImpRdWVyeSIsIiQiLCJLaG9haSIsIlByZU9wdGlvbnMiLCJUZW1wbGF0ZSIsIldhaXRlciIsIkRpYWxvZyIsInRoaXMiLCJfc2VjdGlvbl9oZWFkZXIiLCJzZWxmIiwiZGlhbG9nIiwicmVuZGVyX2RhdGEiLCJvcHRpb25zIiwidHlwZSIsImNsb3NlX2Z1bmMiLCJ0aXRsZSIsIl9zZWN0aW9uX2JvZHkiLCJjb250ZW50IiwiZ2V0Q29udGVudCIsImJvZHlfc3R5bGVzIiwicGFkZGluZyIsInB1c2giLCJvdmVyZmxvdyIsImpvaW4iLCJfc2VjdGlvbl9mb290ZXIiLCJidXR0b25zIiwidGVtcGxhdGUiLCJidXR0b25zX2FsaWduIiwicGVuZGluZ19pbmZvIiwiZWFjaCIsImJ1dHRvbiIsInJlbmRlciIsIl9sYXlvdXQiLCJzaXplX2NsYXNzX21hcCIsImxhcmdlIiwic21hbGwiLCJzaXplIiwibGF5b3V0IiwiaWQiLCJoYXNPd25Qcm9wZXJ0eSIsImNsYXNzZXMiLCJoYXNfaGVhZGVyIiwiaGFzX2Zvb3RlciIsImdldE1vZGFsT3B0aW9uIiwiY2xvc2VfbWFudWFsIiwiYmFja2Ryb3AiLCJrZXlib2FyZCIsIl9vcGVuX2RpYWxvZyIsIm1vZGFsX29wdGlvbnMiLCJnZXREaWFsb2ciLCJkYXRhIiwiY3JlYXRlRnVuYyIsImNsb3NlIiwiYmluZCIsIndhaXRlcl9rZXlzIiwiYXBwZW5kIiwiX3NldERpYWxvZ0RPTUV2ZW50cyIsImdldERPTSIsIm1vZGFsIiwiaW5zdGFuY2UiLCJkb20iLCJvbiIsImV2ZW50IiwidGFyZ2V0IiwiaXMiLCJkaWFsb2dfb3BlbmluZyIsImVtaXRFdmVudCIsImxhc3QiLCJhdHRyIiwidXBkYXRlX2RpYWxvZ19jbG9zZV9zdGF0dXMiLCJjbG9zZWFibGUiLCJpc0Nsb3NlYWJsZSIsImZpbmQiLCJ0b2dnbGVDbGFzcyIsIkJvb3RzdHJhcCIsImZuIiwiRXJyb3IiLCJ0eXBlX3ByZWZpeCIsImNhbGwiLCJnZXQiLCJURU1QTEFURV9CT09UU1RSQVBfUFJFX09QVElPTlNfTkFNRSIsInNldExheW91dCIsInNldFNlY3Rpb24iLCJtaW1pYyIsImFkZExpc3RlbmVyIiwicmVtb3ZlIiwiTWF0aCIsIm1heCIsImhpZGUiLCJzaG93IiwibmV3X2NvbnRlbnQiLCJpc09wZW5lZCIsInVwZGF0ZUNvbnRlbnQiLCJ1dGlsIiwiZGVmaW5lQ29uc3RhbnQiLCJpbmhlcml0IiwicHJvdG90eXBlIiwiX3N1cGVyIiwiZGF0YVNvdXJjZSIsImh0bWwiLCJ1cGRhdGVQZW5kaW5nSW5mbyIsImluZm8iLCJyZWdpc3RlciIsIlRFTVBMQVRFX1RZUEUiLCJEaWFsb2dCdXR0b24iLCJfc2VjdGlvbl9pY29uIiwiZGF0YV9zb3VyY2UiLCJpY29uIiwiY2xhbXAiLCJwYWRkaW5nX3NwYWNlIiwidGltZXMiLCJjb25zdGFudCIsInN0eWxlIiwiaXNWaXNpYmxlIiwiY2xpY2tfa2V5IiwiaXNFbmFibGUiLCJnZXRCdXR0b24iLCJjbGljayIsIm5vdGljZWRfZGF0YSIsInRvZ2dsZSIsInJlbW92ZUF0dHIiLCJwcm9wIiwiaWNvbl9jbGFzcyIsImxhYmVsX2NsYXNzIiwidXBkYXRlTGFiZWwiLCJsYWJlbCIsInVwZGF0ZUljb24iXSwibWFwcGluZ3MiOiJDQUFDLFNBQVVBLEVBQU1DLEdBQ2IsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUFLLENBQzVDLEdBQUlDLElBQ0EsU0FDQSxTQUNBLFVBQ0Esc0JBQ0EsbUJBQ0EsaUJBQ0EsWUFFSkMsU0FBUUQsRUFBY0gsT0FFdEJBLEdBQ0lELEVBQUtNLEVBQ0xOLEVBQUtPLFFBQVVQLEVBQUtRLEVBQ3BCUixFQUFLUyxNQUNKVCxFQUFLUyxPQUFTVCxFQUFLUyxNQUFNQyxZQUFlVixFQUFLVSxXQUM3Q1YsRUFBS1MsT0FBU1QsRUFBS1MsTUFBTUUsVUFBYVgsRUFBS1csU0FDM0NYLEVBQUtTLE9BQVNULEVBQUtTLE1BQU1HLFFBQVdaLEVBQUtZLE9BQ3pDWixFQUFLUyxPQUFTVCxFQUFLUyxNQUFNSSxRQUFXYixFQUFLYSxTQUdwREMsS0FBTSxTQUFVUixFQUFHQyxFQUFRRSxFQUFPQyxFQUFZQyxFQUFVQyxFQUFRQyxHQW9COUQsUUFBU0UsR0FBZ0JDLEVBQU1DLEVBQVFDLEdBR25DLE1BQU8sNkJBRllELEVBQU9FLFFBQVFDLEtBQU8sTUFBUUgsRUFBT0UsUUFBUUMsS0FBTyxJQUVuQixrREFDRUYsRUFBWUcsV0FBYSwrRUFDOUNKLEVBQU9FLFFBQVFHLE1BQVEsY0FJNUQsUUFBU0MsR0FBY1AsRUFBTUMsRUFBUUMsR0FDakMsR0FBSU0sR0FBVVAsRUFBT1EsYUFDakJDLElBT0osT0FMS1osTUFBS0ssUUFBUVEsU0FDZEQsRUFBWUUsS0FBSyxpQkFFckJGLEVBQVlFLEtBQUssYUFBZWQsS0FBS0ssUUFBUVUsU0FBVyxNQUVoRCxrQ0FBbUNILEVBQVlJLEtBQUssS0FBTSxLQUFNTixFQUFTLFVBQVVNLEtBQUssSUFHcEcsUUFBU0MsR0FBZ0JmLEVBQU1DLEVBQVFDLEdBQ25DLEdBQUljLE1BQ0FDLEVBQVcsZ0RBQWtEbkIsS0FBS0ssUUFBUWUsY0FBZ0IsTUFDMUZDLEVBQWUscURBQXNGLFNBQS9CckIsS0FBS0ssUUFBUWUsY0FBMkIsUUFBVSxRQUFVLEtBQU9wQixLQUFLSyxRQUFRZ0IsYUFBZSxxQkFTekssT0FQQTdCLEdBQUU4QixLQUFLbkIsRUFBT2UsUUFBUyxTQUFVSyxHQUM3QkwsRUFBUUosS0FBS1MsRUFBT0MsWUFHeEJMLEdBQVlELEVBQVFGLEtBQUssTUFBUUssRUFDakNGLEdBQVksU0FLaEIsUUFBU00sR0FBUXZCLEVBQU1DLEVBQVFDLEdBQzNCLEdBQUlzQixJQUFrQkMsTUFBTyxLQUFNQyxNQUFPLE1BQ3RDQyxFQUFPLEdBQ1BDLEdBQVUsMEZBQTJGM0IsRUFBTzRCLEdBQUksNkJBcUJwSCxPQWxCSUwsR0FBZU0sZUFBZTdCLEVBQU9FLFFBQVF3QixRQUM3Q0EsRUFBTyxTQUFXSCxFQUFldkIsRUFBT0UsUUFBUXdCLE9BR3BEQyxFQUFPaEIsS0FBSyw0QkFBNkJkLEtBQUtLLFFBQVE0QixRQUFTLElBQUtKLEVBQU0sS0FBTSwrQkFFNUU3QixLQUFLSyxRQUFRNkIsWUFDYkosRUFBT2hCLEtBQUssWUFHaEJnQixFQUFPaEIsS0FBSyxVQUVSZCxLQUFLSyxRQUFROEIsWUFDYkwsRUFBT2hCLEtBQUssWUFHaEJnQixFQUFPaEIsS0FBSyxzQkFFTGdCLEVBQU9kLEtBQUssSUFHdkIsUUFBU29CLEdBQWVDLEdBQ3BCLE9BQ0lDLFVBQVVELEdBQWUsU0FDekJFLFVBQVdGLEdBSW5CLFFBQVNHLEtBQ0wsR0FHSXJCLEdBSEFzQixFQUFnQkwsRUFBZXBDLEtBQUtLLFFBQVFnQyxjQUM1Q2xDLEVBQVNILEtBQUswQyxZQUNkQyxJQUdKQSxHQUFpQixXQUFJN0MsRUFBTzhDLFdBQVcsV0FDbkM1QyxLQUFLMEMsWUFBWUcsU0FDbkJDLEtBQUs5QyxPQUFPLEVBQU0sVUFBWUcsRUFBTzRCLEdBQUssNEJBRTVDL0IsS0FBSytDLFlBQVlqQyxLQUFLNkIsRUFBaUIsWUFFdkN4QixFQUFXbkIsS0FBS3dCLE9BQU9tQixHQUV2QmxELEVBQU8sUUFBUXVELE9BQU83QixHQUN0QjhCLEVBQW9CakQsTUFDcEJQLEVBQU9PLEtBQUtrRCxVQUFVQyxNQUFNVixHQUdoQyxRQUFTUSxHQUFvQkcsR0FDekIsR0FBSUMsR0FBTTVELEVBQU8yRCxFQUFTRixTQUUxQkcsR0FBSUMsR0FBRyxnQkFBaUIsU0FBVUMsR0FDMUI5RCxFQUFPOEQsRUFBTUMsUUFBUUMsR0FBR0osS0FDeEJLLElBQ0FOLEVBQVNPLFVBQVUsV0FJM0JOLEVBQUlDLEdBQUcsaUJBQWtCLFNBQVVDLEdBQzNCOUQsRUFBTzhELEVBQU1DLFFBQVFDLEdBQUdKLEtBQ3hCNUQsRUFBTyx3QkFBd0JtRSxPQUFPQyxLQUFLLEtBQU0sa0JBQW9CVCxFQUFTckIsSUFDOUVxQixFQUFTTyxVQUFVLFlBSTNCTixFQUFJQyxHQUFHLGdCQUFpQixTQUFVQyxHQUMxQjlELEVBQU84RCxFQUFNQyxRQUFRQyxHQUFHSixJQUN4QkQsRUFBU08sVUFBVSxVQUkzQk4sRUFBSUMsR0FBRyxrQkFBbUIsU0FBVUMsR0FDNUI5RCxFQUFPOEQsRUFBTUMsUUFBUUMsR0FBR0osS0FDeEJELEVBQVNPLFVBQVUsVUFDbkJQLEVBQVNWLFlBQVlHLFdBS2pDLFFBQVNpQixLQUNMLEdBQUlDLEdBQVkvRCxLQUFLMEMsWUFBWXNCLGFBQ2pCdkUsR0FBT08sS0FBS2tELFVBRWxCZSxLQUFLLHdCQUF3QkMsWUFBWSxRQUFTSCxHQUloRSxRQUFTSSxLQUNMLElBQUsxRSxFQUFPMkUsR0FBR2pCLE1BQ1gsS0FBTSxJQUFJa0IsT0FBTSw0REFHcEJyRSxNQUFLc0UsWUFBYyw0QkFFbkJ6RSxFQUFTMEUsS0FBS3ZFLE1BRWRBLEtBQUtLLFFBQVVULEVBQVc0RSxJQUFJekUsRUFBTzBFLHFDQUVyQ3pFLEtBQUsrQyxlQUNML0MsS0FBSzBFLFVBQVVqRCxHQUNmekIsS0FBSzJFLFdBQVcsU0FBVTFFLEVBQWdCNkMsS0FBSzlDLE9BQy9DQSxLQUFLMkUsV0FBVyxPQUFRbEUsRUFBY3FDLEtBQUs5QyxPQUMzQ0EsS0FBSzJFLFdBQVcsU0FBVTFELEVBQWdCNkIsS0FBSzlDLE9BRS9DQSxLQUFLNEUsT0FBTyxPQUFRLGdCQUFpQixRQUFTLE9BQVEsT0FBUSxtQkFFOUQ1RSxLQUFLNkUsWUFBWSxPQUFRckMsRUFBYU0sS0FBSzlDLE9BQzNDQSxLQUFLNkUsWUFBWSxnQkFBaUJmLEVBQTJCaEIsS0FBSzlDLE9BQ2xFQSxLQUFLNkUsWUFBWSxRQUFTLFdBQ3RCL0UsRUFBT2dGLE9BQU85RSxLQUFLK0MsYUFDbkIvQyxLQUFLK0MsZUFDTC9DLEtBQUtrRCxTQUFTQyxNQUFNLFFBQ3BCbkQsS0FBS2tELFNBQVM0QixTQUdkcEIsRUFBaUJxQixLQUFLQyxJQUFJLElBQUt0QixHQUMvQmpFLEVBQU8sUUFBUXlFLFlBQVksYUFBY1IsRUFBaUIsR0FFckRBLEdBQ0RqRSxFQUFPLHdCQUF3QnFGLFNBRW5DckYsRUFBTyxtQkFBcUJPLEtBQUsrQixJQUFJK0MsV0FFekM5RSxLQUFLNkUsWUFBWSxPQUFRLFdBQ3JCN0UsS0FBS2tELFNBQVMrQixPQUNkeEYsRUFBTyxtQkFBcUJPLEtBQUsrQixJQUFJa0QsU0FFekNqRixLQUFLNkUsWUFBWSxPQUFRLFdBQ3JCN0UsS0FBS2tELFNBQVNnQyxPQUNkekYsRUFBTyxtQkFBcUJPLEtBQUsrQixJQUFJbUQsU0FFekNsRixLQUFLNkUsWUFBWSxpQkFBa0IsU0FBVU0sR0FDckNuRixLQUFLMEMsWUFBWTBDLFlBQ2pCcEYsS0FBS3FGLGNBQWNGLEtBL0wvQnhGLEVBQU0yRixLQUFLQyxlQUFleEYsR0FDdEIwRSxvQ0FBcUMsb0NBRXpDN0UsRUFBV1IsT0FBT1csRUFBTzBFLHFDQUNyQnZDLFlBQVksRUFDWkMsWUFBWSxFQUNaRSxjQUFjLEVBQ2R4QixTQUFTLEVBQ1RvQixRQUFTLEdBQ1RsQixTQUFVLFNBQ1ZLLGNBQWUsUUFDZkMsYUFBYyxJQUdsQixJQUFJcUMsR0FBaUIsQ0F1THJCL0QsR0FBTTJGLEtBQUtFLFFBQVFyQixFQUFXdEUsR0FDOUJGLEVBQU0yRixLQUFLQyxlQUFlcEIsRUFBVyxVQXhNdkIsU0EwTWRBLEVBQVVzQixVQUFVdkMsT0FBUyxXQUN6QixHQUFJRyxHQUFNckQsS0FBSzBGLE9BQU94QyxPQUFPcUIsS0FBS3ZFLEtBQ2xDLE9BQU9QLEdBQU80RCxJQU9sQmMsRUFBVXNCLFVBQVUvQyxVQUFZLFdBQzVCLE1BQU8xQyxNQUFLMkYsWUFHaEJ4QixFQUFVc0IsVUFBVUosY0FBZ0IsU0FBVUYsR0FDckNBLElBQ0RBLEVBQWNuRixLQUFLMEMsWUFBWXJDLFFBQVFLLFNBRzNDakIsRUFBT08sS0FBS2tELFVBQVVlLEtBQUssZUFBZTJCLEtBQUtULElBR25EaEIsRUFBVXNCLFVBQVVJLGtCQUFvQixTQUFVQyxHQUM5Q3JHLEVBQU9PLEtBQUtrRCxVQUFVZSxLQUFLLHdCQUF3QjJCLEtBQUtFLElBSTVEakcsRUFBU2tHLFNBQVNoRyxFQUFPaUcsY0FBZSxZQUFhN0IsS0FFeEQsU0FBVWpGLEVBQU1DLEdBQ2IsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUFLLENBQzVDLEdBQUlDLElBQ0EsU0FDQSxVQUNBLHNCQUNBLG1CQUNBLGlCQUNBLG1CQUVKQyxTQUFRRCxFQUFjSCxPQUV0QkEsR0FBUUQsRUFBS00sRUFBR04sRUFBS1MsTUFBT1QsRUFBS1UsV0FBWVYsRUFBS1csU0FBVVgsRUFBS1ksT0FBUVosRUFBSytHLGVBRXBGakcsS0FBTSxTQUFVUixFQUFHRyxFQUFPQyxFQUFZQyxFQUFVQyxFQUFRbUcsR0FZdEQsUUFBU0MsR0FBYzlDLEVBQVUrQyxFQUFheEQsR0FDMUMsTUFBSXdELEdBQVk5RixRQUFRK0YsS0FDYiw0R0FFSixHQUdYLFFBQVMzRSxHQUFRMkIsRUFBVStDLEVBQWF4RCxHQUNwQyxHQUFJZCxHQUFPckMsRUFBRTZHLE1BQU1GLEVBQVk5RixRQUFRd0IsS0FBTyxFQUFHLEVBQUcsR0FDaER5RSxFQUFnQjlHLEVBQUUrRyxNQUFhLEVBQVAxRSxFQUFVckMsRUFBRWdILFNBQVMsaUJBQWlCeEYsS0FBSyxJQUNuRUcsRUFBVyxHQUNYc0YsSUFrQkosT0FoQktOLEdBQVlPLGFBQ2JELEVBQU0zRixLQUFLLGlCQUdmSyxHQUFZLGtGQUNaQSxHQUFZLGtDQUFvQ3NGLEVBQU16RixLQUFLLE1BQVEsSUFDbkVHLEdBQVksK0ZBQ1pBLEdBQVksWUFBY2lDLEVBQVN1RCxVQUFZLE1BRTFDUixFQUFZUyxhQUNiekYsR0FBWSx3QkFHaEJBLEdBQVksSUFDWkEsR0FBWW1GLEVBQWdCLGdCQUFrQkEsRUFBZ0IsWUFNbEUsUUFBU25DLEtBQ0xuRSxLQUFLc0UsWUFBYyxtQ0FDbkJ6RSxFQUFTMEUsS0FBS3ZFLEtBRWQsSUFBSUUsR0FBT0YsSUFFWEEsTUFBS0ssUUFBVVQsRUFBVzRFLElBQUl5QixFQUFheEIscUNBRTNDekUsS0FBSzBFLFVBQVVqRCxHQUNmekIsS0FBSzJFLFdBQVcsT0FBUXVCLEVBQWNwRCxLQUFLOUMsT0FDM0NBLEtBQUsyRSxXQUFXLFFBQVMsbUZBRXpCM0UsS0FBSzJHLFVBQVk3RyxFQUFPOEMsV0FBVyxXQUMvQjFDLEVBQUsyRyxZQUFZQyxVQUdyQjlHLEtBQUs0RSxPQUFPLFNBQVUsa0JBRXRCNUUsS0FBSzZFLFlBQVksU0FBVSxTQUFVa0MsR0FDakMvRyxLQUFLa0QsU0FBUzhELE9BQU9ELEVBQWFwRSxRQUV0QzNDLEtBQUs2RSxZQUFZLGdCQUFpQixTQUFVa0MsR0FDcENBLEVBQ0EvRyxLQUFLa0QsU0FBUytELFdBQVcsWUFFekJqSCxLQUFLa0QsU0FBU1csS0FBSyxXQUFZLFlBR25DN0QsS0FBS2tELFNBQVNnRSxLQUFLLFlBQWFILEtBdEV4Q3BILEVBQU0yRixLQUFLQyxlQUFlVSxHQUN0QnhCLG9DQUFxQywwQ0FHekM3RSxFQUFXUixPQUFPNkcsRUFBYXhCLHFDQUMzQjBDLFdBQVkscUJBQ1pDLFlBQWEsd0JBcUVqQnpILEVBQU0yRixLQUFLRSxRQUFRckIsRUFBV3RFLEdBQzlCRixFQUFNMkYsS0FBS0MsZUFBZXBCLEVBQVcsVUE5RXZCLFNBZ0ZkQSxFQUFVc0IsVUFBVXZDLE9BQVMsV0FDekIsR0FBSUcsR0FBTXJELEtBQUswRixPQUFPeEMsT0FBT3FCLEtBQUt2RSxLQUNsQyxPQUFPUCxRQUFPNEQsSUFRbEJjLEVBQVVzQixVQUFVb0IsVUFBWSxXQUM1QixNQUFPN0csTUFBSzJGLFlBR2hCeEIsRUFBVXNCLFVBQVU0QixZQUFjLFNBQVVDLEdBQ3hDdEgsS0FBS2tELFNBQVNlLEtBQUssSUFBTWpFLEtBQUtLLFFBQVErRyxhQUFheEIsS0FBSzBCLElBRzVEbkQsRUFBVXNCLFVBQVU4QixXQUFhLFNBQVVuQixHQUV2Q3BHLEtBQUtrRCxTQUFTZSxLQUFLLElBQU1qRSxLQUFLSyxRQUFROEcsWUFBWXZCLEtBQUssYUFBZVEsRUFBTyxXQUlqRnZHLEVBQVNrRyxTQUFTRSxFQUFhRCxjQUFlLFlBQWE3QiIsImZpbGUiOiJib290c3RyYXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XHJcbiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY2llcyA9IFtcclxuICAgICAgICAgICAgJ2xvZGFzaCcsXHJcbiAgICAgICAgICAgICdqcXVlcnknLFxyXG4gICAgICAgICAgICAna2hvYWlqcycsXHJcbiAgICAgICAgICAgICdraG9haWpzLXByZS1vcHRpb25zJyxcclxuICAgICAgICAgICAgJ2tob2FpanMtdGVtcGxhdGUnLFxyXG4gICAgICAgICAgICAna2hvYWlqcy13YWl0ZXInLFxyXG4gICAgICAgICAgICAnLi4vZGlhbG9nJ1xyXG4gICAgICAgIF07XHJcbiAgICAgICAgcmVxdWlyZShkZXBlbmRlbmNpZXMsIGZhY3RvcnkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBmYWN0b3J5KFxyXG4gICAgICAgICAgICByb290Ll8sXHJcbiAgICAgICAgICAgIHJvb3QualF1ZXJ5IHx8IHJvb3QuJCxcclxuICAgICAgICAgICAgcm9vdC5LaG9haSxcclxuICAgICAgICAgICAgKHJvb3QuS2hvYWkgJiYgcm9vdC5LaG9haS5QcmVPcHRpb25zKSB8fCByb290LlByZU9wdGlvbnMsXHJcbiAgICAgICAgICAgIChyb290Lktob2FpICYmIHJvb3QuS2hvYWkuVGVtcGxhdGUpIHx8IHJvb3QuVGVtcGxhdGUsXHJcbiAgICAgICAgICAgIChyb290Lktob2FpICYmIHJvb3QuS2hvYWkuV2FpdGVyKSB8fCByb290LldhaXRlcixcclxuICAgICAgICAgICAgKHJvb3QuS2hvYWkgJiYgcm9vdC5LaG9haS5EaWFsb2cpIHx8IHJvb3QuRGlhbG9nXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxufSh0aGlzLCBmdW5jdGlvbiAoXywgalF1ZXJ5LCBLaG9haSwgUHJlT3B0aW9ucywgVGVtcGxhdGUsIFdhaXRlciwgRGlhbG9nKSB7XHJcbiAgICB2YXIgdmVyc2lvbiA9ICcwLjAuMSc7XHJcblxyXG4gICAgS2hvYWkudXRpbC5kZWZpbmVDb25zdGFudChEaWFsb2csIHtcclxuICAgICAgICBURU1QTEFURV9CT09UU1RSQVBfUFJFX09QVElPTlNfTkFNRTogJ0tob2FpLkRpYWxvZy5UZW1wbGF0ZS5Cb290c3RyYXAnXHJcbiAgICB9KTtcclxuICAgIFByZU9wdGlvbnMuZGVmaW5lKERpYWxvZy5URU1QTEFURV9CT09UU1RSQVBfUFJFX09QVElPTlNfTkFNRSwge1xyXG4gICAgICAgIGhhc19oZWFkZXI6IHRydWUsXHJcbiAgICAgICAgaGFzX2Zvb3RlcjogdHJ1ZSxcclxuICAgICAgICBjbG9zZV9tYW51YWw6IHRydWUsXHJcbiAgICAgICAgcGFkZGluZzogdHJ1ZSxcclxuICAgICAgICBjbGFzc2VzOiAnJyxcclxuICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXHJcbiAgICAgICAgYnV0dG9uc19hbGlnbjogJ3JpZ2h0JyxcclxuICAgICAgICBwZW5kaW5nX2luZm86ICcnXHJcbiAgICB9KTtcclxuXHJcbiAgICB2YXIgZGlhbG9nX29wZW5pbmcgPSAwO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBfc2VjdGlvbl9oZWFkZXIoc2VsZiwgZGlhbG9nLCByZW5kZXJfZGF0YSkge1xyXG4gICAgICAgIHZhciBoZWFkZXJfY29sb3IgPSBkaWFsb2cub3B0aW9ucy50eXBlID8gJ2JnLScgKyBkaWFsb2cub3B0aW9ucy50eXBlIDogJyc7XHJcblxyXG4gICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlciAnICsgaGVhZGVyX2NvbG9yICsgJ1wiPicgK1xyXG4gICAgICAgICAgICAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJjbG9zZVwiIG9uY2xpY2s9XCInICsgcmVuZGVyX2RhdGEuY2xvc2VfZnVuYyArICcoKVwiPjxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPiZ0aW1lczs8L3NwYW4+PC9idXR0b24+JyArXHJcbiAgICAgICAgICAgICc8aDQgY2xhc3M9XCJtb2RhbC10aXRsZVwiPicgKyBkaWFsb2cub3B0aW9ucy50aXRsZSArICc8L2g0PicgK1xyXG4gICAgICAgICAgICAnPC9kaXY+JztcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBfc2VjdGlvbl9ib2R5KHNlbGYsIGRpYWxvZywgcmVuZGVyX2RhdGEpIHtcclxuICAgICAgICB2YXIgY29udGVudCA9IGRpYWxvZy5nZXRDb250ZW50KCk7XHJcbiAgICAgICAgdmFyIGJvZHlfc3R5bGVzID0gW107XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnBhZGRpbmcpIHtcclxuICAgICAgICAgICAgYm9keV9zdHlsZXMucHVzaCgncGFkZGluZzogMHB4OycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBib2R5X3N0eWxlcy5wdXNoKCdvdmVyZmxvdzogJyArIHRoaXMub3B0aW9ucy5vdmVyZmxvdyArICc7Jyk7XHJcblxyXG4gICAgICAgIHJldHVybiBbJzxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCIgc3R5bGU9XCInLCBib2R5X3N0eWxlcy5qb2luKCcgJyksICdcIj4nLCBjb250ZW50LCAnPC9kaXY+J10uam9pbignJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gX3NlY3Rpb25fZm9vdGVyKHNlbGYsIGRpYWxvZywgcmVuZGVyX2RhdGEpIHtcclxuICAgICAgICB2YXIgYnV0dG9ucyA9IFtdO1xyXG4gICAgICAgIHZhciB0ZW1wbGF0ZSA9ICc8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCIgc3R5bGU9XCJ0ZXh0LWFsaWduOiAnICsgdGhpcy5vcHRpb25zLmJ1dHRvbnNfYWxpZ24gKyAnO1wiPic7XHJcbiAgICAgICAgdmFyIHBlbmRpbmdfaW5mbyA9ICc8c3BhbiBjbGFzcz1cImRpYWxvZy1wZW5kaW5nLWluZm8gdGV4dC1tdXRlZCBwdWxsLScgKyAodGhpcy5vcHRpb25zLmJ1dHRvbnNfYWxpZ24gPT09ICdsZWZ0JyA/ICdyaWdodCcgOiAnbGVmdCcpICsgJ1wiPicgKyB0aGlzLm9wdGlvbnMucGVuZGluZ19pbmZvICsgJzwvc3Bhbj4mbmJzcDsmbmJzcDsnO1xyXG5cclxuICAgICAgICBfLmVhY2goZGlhbG9nLmJ1dHRvbnMsIGZ1bmN0aW9uIChidXR0b24pIHtcclxuICAgICAgICAgICAgYnV0dG9ucy5wdXNoKGJ1dHRvbi5yZW5kZXIoKSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRlbXBsYXRlICs9IGJ1dHRvbnMuam9pbihcIlxcblwiKSArIHBlbmRpbmdfaW5mbztcclxuICAgICAgICB0ZW1wbGF0ZSArPSAnPC9kaXY+JztcclxuXHJcbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIF9sYXlvdXQoc2VsZiwgZGlhbG9nLCByZW5kZXJfZGF0YSkge1xyXG4gICAgICAgIHZhciBzaXplX2NsYXNzX21hcCA9IHtsYXJnZTogJ2xnJywgc21hbGw6ICdzbSd9O1xyXG4gICAgICAgIHZhciBzaXplID0gJyc7XHJcbiAgICAgICAgdmFyIGxheW91dCA9IFsnPGRpdiBjbGFzcz1cIm1vZGFsIGZhZGVcIiB0YWJpbmRleD1cIi0xXCIgcm9sZT1cImRpYWxvZ1wiIGlkPVwiPCU9IGRvbV9pZCAlPlwiIGRhdGEtZGlhbG9nLWlkPVwiJywgZGlhbG9nLmlkLCAnXCIgZGF0YS1kcmF3PVwiPCUtIGRyYXcgJT5cIj4nXTtcclxuXHJcblxyXG4gICAgICAgIGlmIChzaXplX2NsYXNzX21hcC5oYXNPd25Qcm9wZXJ0eShkaWFsb2cub3B0aW9ucy5zaXplKSkge1xyXG4gICAgICAgICAgICBzaXplID0gJ21vZGFsLScgKyBzaXplX2NsYXNzX21hcFtkaWFsb2cub3B0aW9ucy5zaXplXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxheW91dC5wdXNoKCc8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nICcsIHRoaXMub3B0aW9ucy5jbGFzc2VzLCAnICcsIHNpemUsICdcIj4nLCAnPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj4nKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oYXNfaGVhZGVyKSB7XHJcbiAgICAgICAgICAgIGxheW91dC5wdXNoKCdASEVBREVSQCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGF5b3V0LnB1c2goJ0BCT0RZQCcpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhhc19mb290ZXIpIHtcclxuICAgICAgICAgICAgbGF5b3V0LnB1c2goJ0BGT09URVJAJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsYXlvdXQucHVzaCgnPC9kaXY+PC9kaXY+PC9kaXY+Jyk7XHJcblxyXG4gICAgICAgIHJldHVybiBsYXlvdXQuam9pbignJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0TW9kYWxPcHRpb24oY2xvc2VfbWFudWFsKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYmFja2Ryb3A6IGNsb3NlX21hbnVhbCA/ICdzdGF0aWMnIDogdHJ1ZSxcclxuICAgICAgICAgICAga2V5Ym9hcmQ6ICFjbG9zZV9tYW51YWxcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gX29wZW5fZGlhbG9nKCkge1xyXG4gICAgICAgIHZhciBtb2RhbF9vcHRpb25zID0gZ2V0TW9kYWxPcHRpb24odGhpcy5vcHRpb25zLmNsb3NlX21hbnVhbCksXHJcbiAgICAgICAgICAgIGRpYWxvZyA9IHRoaXMuZ2V0RGlhbG9nKCksXHJcbiAgICAgICAgICAgIGRhdGEgPSB7fSxcclxuICAgICAgICAgICAgdGVtcGxhdGU7XHJcblxyXG4gICAgICAgIGRhdGFbJ2Nsb3NlX2Z1bmMnXSA9IFdhaXRlci5jcmVhdGVGdW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy5nZXREaWFsb2coKS5jbG9zZSgpO1xyXG4gICAgICAgIH0uYmluZCh0aGlzKSwgdHJ1ZSwgJ01vZGFsOiAnICsgZGlhbG9nLmlkICsgJyA+Pj4gSGVhZGVyIGNsb3NlIGJ1dHRvbicpO1xyXG5cclxuICAgICAgICB0aGlzLndhaXRlcl9rZXlzLnB1c2goZGF0YVsnY2xvc2VfZnVuYyddKTtcclxuXHJcbiAgICAgICAgdGVtcGxhdGUgPSB0aGlzLnJlbmRlcihkYXRhKTtcclxuXHJcbiAgICAgICAgalF1ZXJ5KCdib2R5JykuYXBwZW5kKHRlbXBsYXRlKTtcclxuICAgICAgICBfc2V0RGlhbG9nRE9NRXZlbnRzKHRoaXMpO1xyXG4gICAgICAgIGpRdWVyeSh0aGlzLmdldERPTSgpKS5tb2RhbChtb2RhbF9vcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBfc2V0RGlhbG9nRE9NRXZlbnRzKGluc3RhbmNlKSB7XHJcbiAgICAgICAgdmFyIGRvbSA9IGpRdWVyeShpbnN0YW5jZS5nZXRET00oKSk7XHJcblxyXG4gICAgICAgIGRvbS5vbignc2hvdy5icy5tb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoalF1ZXJ5KGV2ZW50LnRhcmdldCkuaXMoZG9tKSkge1xyXG4gICAgICAgICAgICAgICAgZGlhbG9nX29wZW5pbmcrKztcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmVtaXRFdmVudCgnc2hvdycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGRvbS5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGpRdWVyeShldmVudC50YXJnZXQpLmlzKGRvbSkpIHtcclxuICAgICAgICAgICAgICAgIGpRdWVyeSgnYm9keSAubW9kYWwtYmFja2Ryb3AnKS5sYXN0KCkuYXR0cignaWQnLCAnbW9kYWwtYmFja2Ryb3BfJyArIGluc3RhbmNlLmlkKTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmVtaXRFdmVudCgnc2hvd24nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkb20ub24oJ2hpZGUuYnMubW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKGpRdWVyeShldmVudC50YXJnZXQpLmlzKGRvbSkpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmVtaXRFdmVudCgnaGlkZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGRvbS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChqUXVlcnkoZXZlbnQudGFyZ2V0KS5pcyhkb20pKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5lbWl0RXZlbnQoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZ2V0RGlhbG9nKCkuY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZV9kaWFsb2dfY2xvc2Vfc3RhdHVzKCkge1xyXG4gICAgICAgIHZhciBjbG9zZWFibGUgPSB0aGlzLmdldERpYWxvZygpLmlzQ2xvc2VhYmxlKCk7XHJcbiAgICAgICAgdmFyIG1vZGFsX2RvbSA9IGpRdWVyeSh0aGlzLmdldERPTSgpKTtcclxuXHJcbiAgICAgICAgbW9kYWxfZG9tLmZpbmQoJy5tb2RhbC1oZWFkZXIgLmNsb3NlJykudG9nZ2xlQ2xhc3MoJ2hpZGUnLCAhY2xvc2VhYmxlKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gQm9vdHN0cmFwKCkge1xyXG4gICAgICAgIGlmICghalF1ZXJ5LmZuLm1vZGFsKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRGlhbG9nIEJvb3RzdHJhcCB0ZW1wbGF0ZSByZXF1aXJlIEJvb3RzdHJhcCBNb2RhbCB0byB3b3JrJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnR5cGVfcHJlZml4ID0gJ3RlbXBsYXRlX2RpYWxvZ19ib290c3RyYXAnO1xyXG5cclxuICAgICAgICBUZW1wbGF0ZS5jYWxsKHRoaXMpO1xyXG5cclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBQcmVPcHRpb25zLmdldChEaWFsb2cuVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUUpO1xyXG5cclxuICAgICAgICB0aGlzLndhaXRlcl9rZXlzID0gW107XHJcbiAgICAgICAgdGhpcy5zZXRMYXlvdXQoX2xheW91dCk7XHJcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdIRUFERVInLCBfc2VjdGlvbl9oZWFkZXIuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdCT0RZJywgX3NlY3Rpb25fYm9keS5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLnNldFNlY3Rpb24oJ0ZPT1RFUicsIF9zZWN0aW9uX2Zvb3Rlci5iaW5kKHRoaXMpKTtcclxuXHJcbiAgICAgICAgdGhpcy5taW1pYyhbJ29wZW4nLCAndG9nZ2xlX2VuYWJsZScsICdjbG9zZScsICdoaWRlJywgJ3Nob3cnLCAndXBkYXRlX2NvbnRlbnQnXSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ29wZW4nLCBfb3Blbl9kaWFsb2cuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcigndG9nZ2xlX2VuYWJsZScsIHVwZGF0ZV9kaWFsb2dfY2xvc2Vfc3RhdHVzLmJpbmQodGhpcykpO1xyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ2Nsb3NlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBXYWl0ZXIucmVtb3ZlKHRoaXMud2FpdGVyX2tleXMpO1xyXG4gICAgICAgICAgICB0aGlzLndhaXRlcl9rZXlzID0gW107XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkubW9kYWwoJ2hpZGUnKTtcclxuICAgICAgICAgICAgdGhpcy5nZXRET00oKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vRml4IG1vZGFsLW9wZW4gY2xhc3Mgb24gYm9keVxyXG4gICAgICAgICAgICBkaWFsb2dfb3BlbmluZyA9IE1hdGgubWF4KDAsIC0tZGlhbG9nX29wZW5pbmcpO1xyXG4gICAgICAgICAgICBqUXVlcnkoJ2JvZHknKS50b2dnbGVDbGFzcygnbW9kYWwtb3BlbicsIGRpYWxvZ19vcGVuaW5nID4gMCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIWRpYWxvZ19vcGVuaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoJ2JvZHkgLm1vZGFsLWJhY2tkcm9wJykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgalF1ZXJ5KCcjbW9kYWwtYmFja2Ryb3BfJyArIHRoaXMuaWQpLnJlbW92ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ2hpZGUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkuaGlkZSgpO1xyXG4gICAgICAgICAgICBqUXVlcnkoJyNtb2RhbC1iYWNrZHJvcF8nICsgdGhpcy5pZCkuaGlkZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3Nob3cnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkuc2hvdygpO1xyXG4gICAgICAgICAgICBqUXVlcnkoJyNtb2RhbC1iYWNrZHJvcF8nICsgdGhpcy5pZCkuc2hvdygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3VwZGF0ZV9jb250ZW50JywgZnVuY3Rpb24gKG5ld19jb250ZW50KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmdldERpYWxvZygpLmlzT3BlbmVkKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ29udGVudChuZXdfY29udGVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgS2hvYWkudXRpbC5pbmhlcml0KEJvb3RzdHJhcCwgVGVtcGxhdGUpO1xyXG4gICAgS2hvYWkudXRpbC5kZWZpbmVDb25zdGFudChCb290c3RyYXAsICd2ZXJzaW9uJywgdmVyc2lvbik7XHJcblxyXG4gICAgQm9vdHN0cmFwLnByb3RvdHlwZS5nZXRET00gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGRvbSA9IHRoaXMuX3N1cGVyLmdldERPTS5jYWxsKHRoaXMpO1xyXG4gICAgICAgIHJldHVybiBqUXVlcnkoZG9tKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMge251bGx8KnxPYmplY3R8RXZlbnRFbWl0dGVyfERpYWxvZ31cclxuICAgICAqL1xyXG4gICAgQm9vdHN0cmFwLnByb3RvdHlwZS5nZXREaWFsb2cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNvdXJjZTtcclxuICAgIH07XHJcblxyXG4gICAgQm9vdHN0cmFwLnByb3RvdHlwZS51cGRhdGVDb250ZW50ID0gZnVuY3Rpb24gKG5ld19jb250ZW50KSB7XHJcbiAgICAgICAgaWYgKCFuZXdfY29udGVudCkge1xyXG4gICAgICAgICAgICBuZXdfY29udGVudCA9IHRoaXMuZ2V0RGlhbG9nKCkub3B0aW9ucy5jb250ZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgalF1ZXJ5KHRoaXMuZ2V0RE9NKCkpLmZpbmQoJy5tb2RhbC1ib2R5JykuaHRtbChuZXdfY29udGVudCk7XHJcbiAgICB9O1xyXG5cclxuICAgIEJvb3RzdHJhcC5wcm90b3R5cGUudXBkYXRlUGVuZGluZ0luZm8gPSBmdW5jdGlvbiAoaW5mbykge1xyXG4gICAgICAgIGpRdWVyeSh0aGlzLmdldERPTSgpKS5maW5kKCcuZGlhbG9nLXBlbmRpbmctaW5mbycpLmh0bWwoaW5mbyk7XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICBUZW1wbGF0ZS5yZWdpc3RlcihEaWFsb2cuVEVNUExBVEVfVFlQRSwgJ0Jvb3RzdHJhcCcsIEJvb3RzdHJhcCk7XHJcbn0pKTtcbihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xyXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgICAgIHZhciBkZXBlbmRlbmNpZXMgPSBbXHJcbiAgICAgICAgICAgICdsb2Rhc2gnLFxyXG4gICAgICAgICAgICAna2hvYWlqcycsXHJcbiAgICAgICAgICAgICdraG9haWpzLXByZS1vcHRpb25zJyxcclxuICAgICAgICAgICAgJ2tob2FpanMtdGVtcGxhdGUnLFxyXG4gICAgICAgICAgICAna2hvYWlqcy13YWl0ZXInLFxyXG4gICAgICAgICAgICAnLi4vZGlhbG9nX2J1dHRvbidcclxuICAgICAgICBdO1xyXG4gICAgICAgIHJlcXVpcmUoZGVwZW5kZW5jaWVzLCBmYWN0b3J5KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZmFjdG9yeShyb290Ll8sIHJvb3QuS2hvYWksIHJvb3QuUHJlT3B0aW9ucywgcm9vdC5UZW1wbGF0ZSwgcm9vdC5XYWl0ZXIsIHJvb3QuRGlhbG9nQnV0dG9uKTtcclxuICAgIH1cclxufSh0aGlzLCBmdW5jdGlvbiAoXywgS2hvYWksIFByZU9wdGlvbnMsIFRlbXBsYXRlLCBXYWl0ZXIsIERpYWxvZ0J1dHRvbikge1xyXG4gICAgdmFyIHZlcnNpb24gPSAnMC4wLjEnO1xyXG5cclxuICAgIEtob2FpLnV0aWwuZGVmaW5lQ29uc3RhbnQoRGlhbG9nQnV0dG9uLCB7XHJcbiAgICAgICAgVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUU6ICdLaG9haS5EaWFsb2dCdXR0b24uVGVtcGxhdGUuQm9vdHN0cmFwJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgUHJlT3B0aW9ucy5kZWZpbmUoRGlhbG9nQnV0dG9uLlRFTVBMQVRFX0JPT1RTVFJBUF9QUkVfT1BUSU9OU19OQU1FLCB7XHJcbiAgICAgICAgaWNvbl9jbGFzczogJ2RpYWxvZ19idXR0b25faWNvbicsXHJcbiAgICAgICAgbGFiZWxfY2xhc3M6ICdkaWFsb2dfYnV0dG9uX2xhYmVsJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gX3NlY3Rpb25faWNvbihpbnN0YW5jZSwgZGF0YV9zb3VyY2UsIGRhdGEpIHtcclxuICAgICAgICBpZiAoZGF0YV9zb3VyY2Uub3B0aW9ucy5pY29uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9XCI8JT0gb3B0aW9uLmljb25fY2xhc3MgJT5cIj48aSBjbGFzcz1cIjwlPSBkYXRhX3NvdXJjZS5vcHRpb25zLmljb24gJT5cIj48L2k+PC9zcGFuPiZuYnNwOyZuYnNwOyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBfbGF5b3V0KGluc3RhbmNlLCBkYXRhX3NvdXJjZSwgZGF0YSkge1xyXG4gICAgICAgIHZhciBzaXplID0gXy5jbGFtcChkYXRhX3NvdXJjZS5vcHRpb25zLnNpemUgLSAxLCAwLCA0KSxcclxuICAgICAgICAgICAgcGFkZGluZ19zcGFjZSA9IF8udGltZXMoc2l6ZSAqIDMsIF8uY29uc3RhbnQoJyZuYnNwOyZuYnNwOycpKS5qb2luKCcnKSxcclxuICAgICAgICAgICAgdGVtcGxhdGUgPSAnJyxcclxuICAgICAgICAgICAgc3R5bGUgPSBbXTtcclxuXHJcbiAgICAgICAgaWYgKCFkYXRhX3NvdXJjZS5pc1Zpc2libGUoKSkge1xyXG4gICAgICAgICAgICBzdHlsZS5wdXNoKCdkaXNwbGF5OiBub25lJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0ZW1wbGF0ZSArPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCI8JT0gZG9tX2lkICU+XCIgZGF0YS1idXR0b24taWQ9XCI8JT0gZGF0YV9zb3VyY2UuaWQgJT5cIic7XHJcbiAgICAgICAgdGVtcGxhdGUgKz0gJ2RhdGEtZHJhdz1cIjwlLSBkcmF3ICU+XCIgc3R5bGU9XCInICsgc3R5bGUuam9pbignOyAnKSArICdcIic7XHJcbiAgICAgICAgdGVtcGxhdGUgKz0gJ2NsYXNzPVwiYnRuIGJ0bi08JT0gZGF0YV9zb3VyY2Uub3B0aW9ucy50eXBlICU+XCIgZGF0YS1uYW1lPVwiPCU9IGRhdGFfc291cmNlLm9wdGlvbnMubmFtZSAlPlwiICc7XHJcbiAgICAgICAgdGVtcGxhdGUgKz0gJ29uY2xpY2s9XCInICsgaW5zdGFuY2UuY2xpY2tfa2V5ICsgJygpXCInO1xyXG5cclxuICAgICAgICBpZiAoIWRhdGFfc291cmNlLmlzRW5hYmxlKCkpIHtcclxuICAgICAgICAgICAgdGVtcGxhdGUgKz0gJyBkaXNhYmxlZD1cImRpc2FibGVkXCInO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGVtcGxhdGUgKz0gJz4nO1xyXG4gICAgICAgIHRlbXBsYXRlICs9IHBhZGRpbmdfc3BhY2UgKyAnQElDT05AQExBQkVMQCcgKyBwYWRkaW5nX3NwYWNlICsgJzwvYnV0dG9uPic7XHJcblxyXG4gICAgICAgIHJldHVybiB0ZW1wbGF0ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZnVuY3Rpb24gQm9vdHN0cmFwKCkge1xyXG4gICAgICAgIHRoaXMudHlwZV9wcmVmaXggPSAndGVtcGxhdGVfZGlhbG9nX2J1dHRvbl9ib290c3RyYXAnO1xyXG4gICAgICAgIFRlbXBsYXRlLmNhbGwodGhpcyk7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gUHJlT3B0aW9ucy5nZXQoRGlhbG9nQnV0dG9uLlRFTVBMQVRFX0JPT1RTVFJBUF9QUkVfT1BUSU9OU19OQU1FKTtcclxuXHJcbiAgICAgICAgdGhpcy5zZXRMYXlvdXQoX2xheW91dCk7XHJcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdJQ09OJywgX3NlY3Rpb25faWNvbi5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLnNldFNlY3Rpb24oJ0xBQkVMJywgJzxzcGFuIGNsYXNzPVwiPCU9IG9wdGlvbi5sYWJlbF9jbGFzcyAlPlwiPjwlPSBkYXRhX3NvdXJjZS5vcHRpb25zLmxhYmVsICU+PC9zcGFuPicpO1xyXG5cclxuICAgICAgICB0aGlzLmNsaWNrX2tleSA9IFdhaXRlci5jcmVhdGVGdW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5nZXRCdXR0b24oKS5jbGljaygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLm1pbWljKFsndG9nZ2xlJywgJ3RvZ2dsZV9lbmFibGUnXSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3RvZ2dsZScsIGZ1bmN0aW9uIChub3RpY2VkX2RhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5nZXRET00oKS50b2dnbGUobm90aWNlZF9kYXRhLmRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3RvZ2dsZV9lbmFibGUnLCBmdW5jdGlvbiAobm90aWNlZF9kYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChub3RpY2VkX2RhdGEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5nZXRET00oKS5wcm9wKCdkaXNhYmxlZCcsICFub3RpY2VkX2RhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBLaG9haS51dGlsLmluaGVyaXQoQm9vdHN0cmFwLCBUZW1wbGF0ZSk7XHJcbiAgICBLaG9haS51dGlsLmRlZmluZUNvbnN0YW50KEJvb3RzdHJhcCwgJ3ZlcnNpb24nLCB2ZXJzaW9uKTtcclxuXHJcbiAgICBCb290c3RyYXAucHJvdG90eXBlLmdldERPTSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZG9tID0gdGhpcy5fc3VwZXIuZ2V0RE9NLmNhbGwodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIGpRdWVyeShkb20pO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMge251bGx8KnxPYmplY3R8RXZlbnRFbWl0dGVyfERpYWxvZ31cclxuICAgICAqL1xyXG4gICAgQm9vdHN0cmFwLnByb3RvdHlwZS5nZXRCdXR0b24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNvdXJjZTtcclxuICAgIH07XHJcblxyXG4gICAgQm9vdHN0cmFwLnByb3RvdHlwZS51cGRhdGVMYWJlbCA9IGZ1bmN0aW9uIChsYWJlbCkge1xyXG4gICAgICAgIHRoaXMuZ2V0RE9NKCkuZmluZCgnLicgKyB0aGlzLm9wdGlvbnMubGFiZWxfY2xhc3MpLmh0bWwobGFiZWwpO1xyXG4gICAgfTtcclxuXHJcbiAgICBCb290c3RyYXAucHJvdG90eXBlLnVwZGF0ZUljb24gPSBmdW5jdGlvbiAoaWNvbikge1xyXG5cclxuICAgICAgICB0aGlzLmdldERPTSgpLmZpbmQoJy4nICsgdGhpcy5vcHRpb25zLmljb25fY2xhc3MpLmh0bWwoJzxpIGNsYXNzPVwiJyArIGljb24gKyAnXCI+PC9pPicpO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgVGVtcGxhdGUucmVnaXN0ZXIoRGlhbG9nQnV0dG9uLlRFTVBMQVRFX1RZUEUsICdCb290c3RyYXAnLCBCb290c3RyYXApO1xyXG59KSk7Il19
