!function(t,i){if("function"==typeof define&&define.amd){var o=["lodash","jquery","khoaijs","khoaijs-pre-options","khoaijs-template","khoaijs-waiter","../dialog_button","../dialog"];require(o,i)}else i(t._,t.jQuery||t.$,t.Khoai,t.Khoai&&t.Khoai.PreOptions||t.PreOptions,t.Khoai&&t.Khoai.Template||t.Template,t.Khoai&&t.Khoai.Waiter||t.Waiter,t.Khoai&&t.Khoai.Ajax||t.Ajax,t.Khoai&&t.Khoai.DialogButton||t.DialogButton,t.Khoai&&t.Khoai.Dialog||t.Dialog)}(this,function(t,i,o,e,n,s,a,d,l){function h(t,i,o){return'<div class="modal-header '+(i.options.type?"bg-"+i.options.type:"")+'"><button type="button" class="close" onclick="'+o.close_func+'()"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+i.options.title+"</h4></div>"}function r(t,i,o){var e=i.getContent(),n=[];return this.options.padding||n.push("padding: 0px;"),n.push("overflow: "+this.options.overflow+";"),['<div class="modal-body" style="',n.join(" "),'">',e,"</div>"].join("")}function p(i,o,e){var n=[],s='<div class="modal-footer" style="text-align: '+this.options.buttons_align+';">',a='<span class="dialog-pending-info text-muted pull-'+("left"===this.options.buttons_align?"right":"left")+'">'+this.options.pending_info+"</span>&nbsp;&nbsp;";return t.each(o.buttons,function(t){n.push(t.render())}),s+=n.join("\n")+a,s+="</div>"}function c(t,i,o){var e={large:"lg",small:"sm"},n="",s=['<div class="modal fade" tabindex="-1" role="dialog" id="<%= dom_id %>" data-dialog-id="',i.id,'" data-draw="<%- draw %>">'];return e.hasOwnProperty(i.options.size)&&(n="modal-"+e[i.options.size]),s.push('<div class="modal-dialog ',this.options.classes," ",n,'">','<div class="modal-content">'),this.options.has_header&&s.push("@HEADER@"),s.push("@BODY@"),this.options.has_footer&&s.push("@FOOTER@"),s.push("</div></div></div>"),s.join("")}function u(t){return{backdrop:!t||"static",keyboard:!t}}function g(){var t,o=u(this.options.close_manual),e=this.getDialog(),n={};n.close_func=s.createFunc(function(){this.getDialog().close()}.bind(this),!0,"Modal: "+e.id+" >>> Header close button"),this.waiter_keys.push(n.close_func),t=this.render(n),i("body").append(t),_(this),i(this.getDOM()).modal(o)}function _(t){var o=i(t.getDOM());o.on("show.bs.modal",function(e){i(e.target).is(o)&&(m++,t.emitEvent("show"))}),o.on("shown.bs.modal",function(e){i(e.target).is(o)&&(i("body .modal-backdrop").last().attr("id","modal-backdrop_"+t.id),t.emitEvent("shown"))}),o.on("hide.bs.modal",function(e){i(e.target).is(o)&&t.emitEvent("hide")}),o.on("hidden.bs.modal",function(e){i(e.target).is(o)&&(t.emitEvent("hidden"),t.getDialog().close())})}function f(){var t=this.getDialog().isCloseable();i(this.getDOM()).find(".modal-header .close").toggleClass("hide",!t)}function b(){if(!i.fn.modal)throw new Error("Dialog Bootstrap template require Bootstrap Modal to work");this.type_prefix="template_dialog_bootstrap",n.call(this),this.options=e.get(d.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME),this.waiter_keys=[],this.setLayout(c),this.setSection("HEADER",h.bind(this)),this.setSection("BODY",r.bind(this)),this.setSection("FOOTER",p.bind(this)),this.mimic(["open","toggle_enable","close","hide","show","update_content"]),this.addListener("open",g.bind(this)),this.addListener("toggle_enable",f.bind(this)),this.addListener("close",function(){s.remove(this.waiter_keys),this.waiter_keys=[],this.getDOM().modal("hide"),this.getDOM().remove(),m=Math.max(0,--m),i("body").toggleClass("modal-open",m>0),m||i("body .modal-backdrop").remove(),i("#modal-backdrop_"+this.id).remove()}),this.addListener("hide",function(){this.getDOM().hide(),i("#modal-backdrop_"+this.id).hide()}),this.addListener("show",function(){this.getDOM().show(),i("#modal-backdrop_"+this.id).show()}),this.addListener("update_content",function(t){this.getDialog().isOpened()&&this.updateContent(t)})}o.util.defineConstant(d,{TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME:"Khoai.Dialog.Template.Bootstrap"}),e.define(d.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME,{has_header:!0,has_footer:!0,close_manual:!0,padding:!0,classes:"",overflow:"hidden",buttons_align:"right",pending_info:""});var m=0;o.util.inherit(b,n),o.util.defineConstant(b,"version","0.0.1"),b.prototype.getDOM=function(){var t=this._super.getDOM.call(this);return i(t)},b.prototype.getDialog=function(){return this.dataSource},b.prototype.updateContent=function(t){t||(t=this.getDialog().options.content),i(this.getDOM()).find(".modal-body").html(t)},b.prototype.updatePendingInfo=function(t){i(this.getDOM()).find(".dialog-pending-info").html(t)},n.register(l.TEMPLATE_TYPE,"Bootstrap",b)}),function(t,i){if("function"==typeof define&&define.amd){var o=["lodash","khoaijs","khoaijs-pre-options","khoaijs-template","khoaijs-waiter","../dialog_button","../dialog"];require(o,i)}else i(t._,t.Khoai,t.PreOptions,t.Template,t.Waiter,t.DialogButton,t.Dialog)}(this,function(t,i,o,e,n,s,a){function d(t,i,o){return i.options.icon?'<span class="<%= option.icon_class %>"><i class="<%= data_source.options.icon %>"></i></span>&nbsp;&nbsp;':""}function l(i,o,e){var n=t.clamp(o.options.size-1,0,4),s=t.times(3*n,t.constant("&nbsp;&nbsp;")).join(""),a="",d=[];return o.isVisible()||d.push("display: none"),a+='<button type="button" id="<%= dom_id %>" data-button-id="<%= data_source.id %>"',a+='data-draw="<%- draw %>" style="'+d.join("; ")+'"',a+='class="btn btn-<%= data_source.options.type %>" data-name="<%= data_source.options.name %>" ',a+='onclick="'+i.click_key+'()"',o.isEnable()||(a+=' disabled="disabled"'),a+=">",a+=s+"@ICON@@LABEL@"+s+"</button>"}function h(){this.type_prefix="template_dialog_button_bootstrap",e.call(this);var t=this;this.options=o.get(s.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME),this.setLayout(l),this.setSection("ICON",d.bind(this)),this.setSection("LABEL",'<span class="<%= option.label_class %>"><%= data_source.options.label %></span>'),this.click_key=n.createFunc(function(){t.getButton().click()}),this.mimic(["toggle","toggle_enable"]),this.addListener("toggle",function(t){this.getDOM().toggle(t.data)}),this.addListener("toggle_enable",function(t){t?this.getDOM().removeAttr("disabled"):this.getDOM().attr("disabled","disabled"),this.getDOM().prop("disabled",!t)})}i.util.defineConstant(s,{TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME:"Khoai.DialogButton.Template.Bootstrap"}),o.define(s.TEMPLATE_BOOTSTRAP_PRE_OPTIONS_NAME,{icon_class:"dialog_button_icon",label_class:"dialog_button_label"}),i.util.inherit(h,e),i.util.defineConstant(h,"version","0.0.1"),h.prototype.getDOM=function(){var t=this._super.getDOM.call(this);return jQuery(t)},h.prototype.getButton=function(){return this.dataSource},h.prototype.updateLabel=function(t){this.getDOM().find("."+this.options.label_class).html(t)},h.prototype.updateIcon=function(t){this.getDOM().find("."+this.options.icon_class).html('<i class="'+t+'"></i>')},e.register(s.TEMPLATE_TYPE,"Bootstrap",h)});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvb3RzdHJhcC5taW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJkZXBlbmRlbmNpZXMiLCJyZXF1aXJlIiwiXyIsImpRdWVyeSIsIiQiLCJLaG9haSIsIlByZU9wdGlvbnMiLCJUZW1wbGF0ZSIsIldhaXRlciIsIkFqYXgiLCJEaWFsb2dCdXR0b24iLCJEaWFsb2ciLCJ0aGlzIiwiX3NlY3Rpb25faGVhZGVyIiwic2VsZiIsImRpYWxvZyIsInJlbmRlcl9kYXRhIiwib3B0aW9ucyIsInR5cGUiLCJjbG9zZV9mdW5jIiwidGl0bGUiLCJfc2VjdGlvbl9ib2R5IiwiY29udGVudCIsImdldENvbnRlbnQiLCJib2R5X3N0eWxlcyIsInBhZGRpbmciLCJwdXNoIiwib3ZlcmZsb3ciLCJqb2luIiwiX3NlY3Rpb25fZm9vdGVyIiwiYnV0dG9ucyIsInRlbXBsYXRlIiwiYnV0dG9uc19hbGlnbiIsInBlbmRpbmdfaW5mbyIsImVhY2giLCJidXR0b24iLCJyZW5kZXIiLCJfbGF5b3V0Iiwic2l6ZV9jbGFzc19tYXAiLCJsYXJnZSIsInNtYWxsIiwic2l6ZSIsImxheW91dCIsImlkIiwiaGFzT3duUHJvcGVydHkiLCJjbGFzc2VzIiwiaGFzX2hlYWRlciIsImhhc19mb290ZXIiLCJnZXRNb2RhbE9wdGlvbiIsImNsb3NlX21hbnVhbCIsImJhY2tkcm9wIiwia2V5Ym9hcmQiLCJfb3Blbl9kaWFsb2ciLCJtb2RhbF9vcHRpb25zIiwiZ2V0RGlhbG9nIiwiZGF0YSIsImNyZWF0ZUZ1bmMiLCJjbG9zZSIsImJpbmQiLCJ3YWl0ZXJfa2V5cyIsImFwcGVuZCIsIl9zZXREaWFsb2dET01FdmVudHMiLCJnZXRET00iLCJtb2RhbCIsImluc3RhbmNlIiwiZG9tIiwib24iLCJldmVudCIsInRhcmdldCIsImlzIiwiZGlhbG9nX29wZW5pbmciLCJlbWl0RXZlbnQiLCJsYXN0IiwiYXR0ciIsInVwZGF0ZV9kaWFsb2dfY2xvc2Vfc3RhdHVzIiwiY2xvc2VhYmxlIiwiaXNDbG9zZWFibGUiLCJmaW5kIiwidG9nZ2xlQ2xhc3MiLCJCb290c3RyYXAiLCJmbiIsIkVycm9yIiwidHlwZV9wcmVmaXgiLCJjYWxsIiwiZ2V0IiwiVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUUiLCJzZXRMYXlvdXQiLCJzZXRTZWN0aW9uIiwibWltaWMiLCJhZGRMaXN0ZW5lciIsInJlbW92ZSIsIk1hdGgiLCJtYXgiLCJoaWRlIiwic2hvdyIsIm5ld19jb250ZW50IiwiaXNPcGVuZWQiLCJ1cGRhdGVDb250ZW50IiwidXRpbCIsImRlZmluZUNvbnN0YW50IiwiaW5oZXJpdCIsInByb3RvdHlwZSIsIl9zdXBlciIsImRhdGFTb3VyY2UiLCJodG1sIiwidXBkYXRlUGVuZGluZ0luZm8iLCJpbmZvIiwicmVnaXN0ZXIiLCJURU1QTEFURV9UWVBFIiwiX3NlY3Rpb25faWNvbiIsImRhdGFfc291cmNlIiwiaWNvbiIsImNsYW1wIiwicGFkZGluZ19zcGFjZSIsInRpbWVzIiwiY29uc3RhbnQiLCJzdHlsZSIsImlzVmlzaWJsZSIsImNsaWNrX2tleSIsImlzRW5hYmxlIiwiZ2V0QnV0dG9uIiwiY2xpY2siLCJub3RpY2VkX2RhdGEiLCJ0b2dnbGUiLCJyZW1vdmVBdHRyIiwicHJvcCIsImljb25fY2xhc3MiLCJsYWJlbF9jbGFzcyIsInVwZGF0ZUxhYmVsIiwibGFiZWwiLCJ1cGRhdGVJY29uIl0sIm1hcHBpbmdzIjoiQ0FBQyxTQUFVQSxFQUFNQyxHQUNiLEdBQXNCLGtCQUFYQyxTQUF5QkEsT0FBT0MsSUFBSyxDQUM1QyxHQUFJQyxJQUNBLFNBQ0EsU0FDQSxVQUNBLHNCQUNBLG1CQUNBLGlCQUNBLG1CQUNBLFlBRUpDLFNBQVFELEVBQWNILE9BRXRCQSxHQUNJRCxFQUFLTSxFQUNMTixFQUFLTyxRQUFVUCxFQUFLUSxFQUNwQlIsRUFBS1MsTUFDSlQsRUFBS1MsT0FBU1QsRUFBS1MsTUFBTUMsWUFBZVYsRUFBS1UsV0FDN0NWLEVBQUtTLE9BQVNULEVB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S0FBSyxJQUFNakUsS0FBS0ssUUFBUTZHLFlBQVl0QixLQUFLLGFBQWVPLEVBQU8sV0FJakZ4RyxFQUFTb0csU0FBU2pHLEVBQWFrRyxjQUFlLFlBQWE3QiIsImZpbGUiOiJib290c3RyYXAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICB2YXIgZGVwZW5kZW5jaWVzID0gW1xuICAgICAgICAgICAgJ2xvZGFzaCcsXG4gICAgICAgICAgICAnanF1ZXJ5JyxcbiAgICAgICAgICAgICdraG9haWpzJyxcbiAgICAgICAgICAgICdraG9haWpzLXByZS1vcHRpb25zJyxcbiAgICAgICAgICAgICdraG9haWpzLXRlbXBsYXRlJyxcbiAgICAgICAgICAgICdraG9haWpzLXdhaXRlcicsXG4gICAgICAgICAgICAnLi4vZGlhbG9nX2J1dHRvbicsXG4gICAgICAgICAgICAnLi4vZGlhbG9nJ1xuICAgICAgICBdO1xuICAgICAgICByZXF1aXJlKGRlcGVuZGVuY2llcywgZmFjdG9yeSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZmFjdG9yeShcbiAgICAgICAgICAgIHJvb3QuXyxcbiAgICAgICAgICAgIHJvb3QualF1ZXJ5IHx8IHJvb3QuJCxcbiAgICAgICAgICAgIHJvb3QuS2hvYWksXG4gICAgICAgICAgICAocm9vdC5LaG9haSAmJiByb290Lktob2FpLlByZU9wdGlvbnMpIHx8IHJvb3QuUHJlT3B0aW9ucyxcbiAgICAgICAgICAgIChyb290Lktob2FpICYmIHJvb3QuS2hvYWkuVGVtcGxhdGUpIHx8IHJvb3QuVGVtcGxhdGUsXG4gICAgICAgICAgICAocm9vdC5LaG9haSAmJiByb290Lktob2FpLldhaXRlcikgfHwgcm9vdC5XYWl0ZXIsXG4gICAgICAgICAgICAocm9vdC5LaG9haSAmJiByb290Lktob2FpLkFqYXgpIHx8IHJvb3QuQWpheCxcbiAgICAgICAgICAgIChyb290Lktob2FpICYmIHJvb3QuS2hvYWkuRGlhbG9nQnV0dG9uKSB8fCByb290LkRpYWxvZ0J1dHRvbixcbiAgICAgICAgICAgIChyb290Lktob2FpICYmIHJvb3QuS2hvYWkuRGlhbG9nKSB8fCByb290LkRpYWxvZ1xuICAgICAgICApO1xuICAgIH1cbn0odGhpcywgZnVuY3Rpb24gKF8sIGpRdWVyeSwgS2hvYWksIFByZU9wdGlvbnMsIFRlbXBsYXRlLCBXYWl0ZXIsIEFqYXgsIERpYWxvZ0J1dHRvbiwgRGlhbG9nKSB7XG4gICAgdmFyIHZlcnNpb24gPSAnMC4wLjEnO1xuXG4gICAgS2hvYWkudXRpbC5kZWZpbmVDb25zdGFudChEaWFsb2dCdXR0b24sIHtcbiAgICAgICAgVEVNUExBVEVfQk9PVFNUUkFQX1BSRV9PUFRJT05TX05BTUU6ICdLaG9haS5EaWFsb2cuVGVtcGxhdGUuQm9vdHN0cmFwJ1xuICAgIH0pO1xuICAgIFByZU9wdGlvbnMuZGVmaW5lKERpYWxvZ0J1dHRvbi5URU1QTEFURV9CT09UU1RSQVBfUFJFX09QVElPTlNfTkFNRSwge1xuICAgICAgICBoYXNfaGVhZGVyOiB0cnVlLFxuICAgICAgICBoYXNfZm9vdGVyOiB0cnVlLFxuICAgICAgICBjbG9zZV9tYW51YWw6IHRydWUsXG4gICAgICAgIHBhZGRpbmc6IHRydWUsXG4gICAgICAgIGNsYXNzZXM6ICcnLFxuICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICAgIGJ1dHRvbnNfYWxpZ246ICdyaWdodCcsXG4gICAgICAgIHBlbmRpbmdfaW5mbzogJydcbiAgICB9KTtcblxuICAgIHZhciBkaWFsb2dfb3BlbmluZyA9IDA7XG5cblxuICAgIGZ1bmN0aW9uIF9zZWN0aW9uX2hlYWRlcihzZWxmLCBkaWFsb2csIHJlbmRlcl9kYXRhKSB7XG4gICAgICAgIHZhciBoZWFkZXJfY29sb3IgPSBkaWFsb2cub3B0aW9ucy50eXBlID8gJ2JnLScgKyBkaWFsb2cub3B0aW9ucy50eXBlIDogJyc7XG5cbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyICcgKyBoZWFkZXJfY29sb3IgKyAnXCI+JyArXG4gICAgICAgICAgICAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJjbG9zZVwiIG9uY2xpY2s9XCInICsgcmVuZGVyX2RhdGEuY2xvc2VfZnVuYyArICcoKVwiPjxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPiZ0aW1lczs8L3NwYW4+PC9idXR0b24+JyArXG4gICAgICAgICAgICAnPGg0IGNsYXNzPVwibW9kYWwtdGl0bGVcIj4nICsgZGlhbG9nLm9wdGlvbnMudGl0bGUgKyAnPC9oND4nICtcbiAgICAgICAgICAgICc8L2Rpdj4nO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9zZWN0aW9uX2JvZHkoc2VsZiwgZGlhbG9nLCByZW5kZXJfZGF0YSkge1xuICAgICAgICB2YXIgY29udGVudCA9IGRpYWxvZy5nZXRDb250ZW50KCk7XG4gICAgICAgIHZhciBib2R5X3N0eWxlcyA9IFtdO1xuXG4gICAgICAgIGlmICghdGhpcy5vcHRpb25zLnBhZGRpbmcpIHtcbiAgICAgICAgICAgIGJvZHlfc3R5bGVzLnB1c2goJ3BhZGRpbmc6IDBweDsnKTtcbiAgICAgICAgfVxuICAgICAgICBib2R5X3N0eWxlcy5wdXNoKCdvdmVyZmxvdzogJyArIHRoaXMub3B0aW9ucy5vdmVyZmxvdyArICc7Jyk7XG5cbiAgICAgICAgcmV0dXJuIFsnPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIiBzdHlsZT1cIicsIGJvZHlfc3R5bGVzLmpvaW4oJyAnKSwgJ1wiPicsIGNvbnRlbnQsICc8L2Rpdj4nXS5qb2luKCcnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBfc2VjdGlvbl9mb290ZXIoc2VsZiwgZGlhbG9nLCByZW5kZXJfZGF0YSkge1xuICAgICAgICB2YXIgYnV0dG9ucyA9IFtdO1xuICAgICAgICB2YXIgdGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cIm1vZGFsLWZvb3RlclwiIHN0eWxlPVwidGV4dC1hbGlnbjogJyArIHRoaXMub3B0aW9ucy5idXR0b25zX2FsaWduICsgJztcIj4nO1xuICAgICAgICB2YXIgcGVuZGluZ19pbmZvID0gJzxzcGFuIGNsYXNzPVwiZGlhbG9nLXBlbmRpbmctaW5mbyB0ZXh0LW11dGVkIHB1bGwtJyArICh0aGlzLm9wdGlvbnMuYnV0dG9uc19hbGlnbiA9PT0gJ2xlZnQnID8gJ3JpZ2h0JyA6ICdsZWZ0JykgKyAnXCI+JyArIHRoaXMub3B0aW9ucy5wZW5kaW5nX2luZm8gKyAnPC9zcGFuPiZuYnNwOyZuYnNwOyc7XG5cbiAgICAgICAgXy5lYWNoKGRpYWxvZy5idXR0b25zLCBmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgICAgICBidXR0b25zLnB1c2goYnV0dG9uLnJlbmRlcigpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVtcGxhdGUgKz0gYnV0dG9ucy5qb2luKFwiXFxuXCIpICsgcGVuZGluZ19pbmZvO1xuICAgICAgICB0ZW1wbGF0ZSArPSAnPC9kaXY+JztcblxuICAgICAgICByZXR1cm4gdGVtcGxhdGU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2xheW91dChzZWxmLCBkaWFsb2csIHJlbmRlcl9kYXRhKSB7XG4gICAgICAgIHZhciBzaXplX2NsYXNzX21hcCA9IHtsYXJnZTogJ2xnJywgc21hbGw6ICdzbSd9O1xuICAgICAgICB2YXIgc2l6ZSA9ICcnO1xuICAgICAgICB2YXIgbGF5b3V0ID0gWyc8ZGl2IGNsYXNzPVwibW9kYWwgZmFkZVwiIHRhYmluZGV4PVwiLTFcIiByb2xlPVwiZGlhbG9nXCIgaWQ9XCI8JT0gZG9tX2lkICU+XCIgZGF0YS1kaWFsb2ctaWQ9XCInLCBkaWFsb2cuaWQsICdcIiBkYXRhLWRyYXc9XCI8JS0gZHJhdyAlPlwiPiddO1xuXG5cbiAgICAgICAgaWYgKHNpemVfY2xhc3NfbWFwLmhhc093blByb3BlcnR5KGRpYWxvZy5vcHRpb25zLnNpemUpKSB7XG4gICAgICAgICAgICBzaXplID0gJ21vZGFsLScgKyBzaXplX2NsYXNzX21hcFtkaWFsb2cub3B0aW9ucy5zaXplXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxheW91dC5wdXNoKCc8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nICcsIHRoaXMub3B0aW9ucy5jbGFzc2VzLCAnICcsIHNpemUsICdcIj4nLCAnPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIj4nKTtcblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhhc19oZWFkZXIpIHtcbiAgICAgICAgICAgIGxheW91dC5wdXNoKCdASEVBREVSQCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGF5b3V0LnB1c2goJ0BCT0RZQCcpO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGFzX2Zvb3Rlcikge1xuICAgICAgICAgICAgbGF5b3V0LnB1c2goJ0BGT09URVJAJyk7XG4gICAgICAgIH1cblxuICAgICAgICBsYXlvdXQucHVzaCgnPC9kaXY+PC9kaXY+PC9kaXY+Jyk7XG5cbiAgICAgICAgcmV0dXJuIGxheW91dC5qb2luKCcnKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRNb2RhbE9wdGlvbihjbG9zZV9tYW51YWwpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJhY2tkcm9wOiBjbG9zZV9tYW51YWwgPyAnc3RhdGljJyA6IHRydWUsXG4gICAgICAgICAgICBrZXlib2FyZDogIWNsb3NlX21hbnVhbFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX29wZW5fZGlhbG9nKCkge1xuICAgICAgICB2YXIgbW9kYWxfb3B0aW9ucyA9IGdldE1vZGFsT3B0aW9uKHRoaXMub3B0aW9ucy5jbG9zZV9tYW51YWwpLFxuICAgICAgICAgICAgZGlhbG9nID0gdGhpcy5nZXREaWFsb2coKSxcbiAgICAgICAgICAgIGRhdGEgPSB7fSxcbiAgICAgICAgICAgIHRlbXBsYXRlO1xuXG4gICAgICAgIGRhdGFbJ2Nsb3NlX2Z1bmMnXSA9IFdhaXRlci5jcmVhdGVGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RGlhbG9nKCkuY2xvc2UoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpLCB0cnVlLCAnTW9kYWw6ICcgKyBkaWFsb2cuaWQgKyAnID4+PiBIZWFkZXIgY2xvc2UgYnV0dG9uJyk7XG5cbiAgICAgICAgdGhpcy53YWl0ZXJfa2V5cy5wdXNoKGRhdGFbJ2Nsb3NlX2Z1bmMnXSk7XG5cbiAgICAgICAgdGVtcGxhdGUgPSB0aGlzLnJlbmRlcihkYXRhKTtcblxuICAgICAgICBqUXVlcnkoJ2JvZHknKS5hcHBlbmQodGVtcGxhdGUpO1xuICAgICAgICBfc2V0RGlhbG9nRE9NRXZlbnRzKHRoaXMpO1xuICAgICAgICBqUXVlcnkodGhpcy5nZXRET00oKSkubW9kYWwobW9kYWxfb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX3NldERpYWxvZ0RPTUV2ZW50cyhpbnN0YW5jZSkge1xuICAgICAgICB2YXIgZG9tID0galF1ZXJ5KGluc3RhbmNlLmdldERPTSgpKTtcblxuICAgICAgICBkb20ub24oJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChqUXVlcnkoZXZlbnQudGFyZ2V0KS5pcyhkb20pKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9nX29wZW5pbmcrKztcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5lbWl0RXZlbnQoJ3Nob3cnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZG9tLm9uKCdzaG93bi5icy5tb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKGpRdWVyeShldmVudC50YXJnZXQpLmlzKGRvbSkpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkoJ2JvZHkgLm1vZGFsLWJhY2tkcm9wJykubGFzdCgpLmF0dHIoJ2lkJywgJ21vZGFsLWJhY2tkcm9wXycgKyBpbnN0YW5jZS5pZCk7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZW1pdEV2ZW50KCdzaG93bicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkb20ub24oJ2hpZGUuYnMubW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChqUXVlcnkoZXZlbnQudGFyZ2V0KS5pcyhkb20pKSB7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZW1pdEV2ZW50KCdoaWRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRvbS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiAoalF1ZXJ5KGV2ZW50LnRhcmdldCkuaXMoZG9tKSkge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmVtaXRFdmVudCgnaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZ2V0RGlhbG9nKCkuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdXBkYXRlX2RpYWxvZ19jbG9zZV9zdGF0dXMoKSB7XG4gICAgICAgIHZhciBjbG9zZWFibGUgPSB0aGlzLmdldERpYWxvZygpLmlzQ2xvc2VhYmxlKCk7XG4gICAgICAgIHZhciBtb2RhbF9kb20gPSBqUXVlcnkodGhpcy5nZXRET00oKSk7XG5cbiAgICAgICAgbW9kYWxfZG9tLmZpbmQoJy5tb2RhbC1oZWFkZXIgLmNsb3NlJykudG9nZ2xlQ2xhc3MoJ2hpZGUnLCAhY2xvc2VhYmxlKTtcblxuICAgIH1cblxuICAgIGZ1bmN0aW9uIEJvb3RzdHJhcCgpIHtcbiAgICAgICAgaWYgKCFqUXVlcnkuZm4ubW9kYWwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRGlhbG9nIEJvb3RzdHJhcCB0ZW1wbGF0ZSByZXF1aXJlIEJvb3RzdHJhcCBNb2RhbCB0byB3b3JrJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnR5cGVfcHJlZml4ID0gJ3RlbXBsYXRlX2RpYWxvZ19ib290c3RyYXAnO1xuXG4gICAgICAgIFRlbXBsYXRlLmNhbGwodGhpcyk7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gUHJlT3B0aW9ucy5nZXQoRGlhbG9nQnV0dG9uLlRFTVBMQVRFX0JPT1RTVFJBUF9QUkVfT1BUSU9OU19OQU1FKTtcblxuICAgICAgICB0aGlzLndhaXRlcl9rZXlzID0gW107XG4gICAgICAgIHRoaXMuc2V0TGF5b3V0KF9sYXlvdXQpO1xuICAgICAgICB0aGlzLnNldFNlY3Rpb24oJ0hFQURFUicsIF9zZWN0aW9uX2hlYWRlci5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdCT0RZJywgX3NlY3Rpb25fYm9keS5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdGT09URVInLCBfc2VjdGlvbl9mb290ZXIuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5taW1pYyhbJ29wZW4nLCAndG9nZ2xlX2VuYWJsZScsICdjbG9zZScsICdoaWRlJywgJ3Nob3cnLCAndXBkYXRlX2NvbnRlbnQnXSk7XG5cbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcignb3BlbicsIF9vcGVuX2RpYWxvZy5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcigndG9nZ2xlX2VuYWJsZScsIHVwZGF0ZV9kaWFsb2dfY2xvc2Vfc3RhdHVzLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmFkZExpc3RlbmVyKCdjbG9zZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIFdhaXRlci5yZW1vdmUodGhpcy53YWl0ZXJfa2V5cyk7XG4gICAgICAgICAgICB0aGlzLndhaXRlcl9rZXlzID0gW107XG4gICAgICAgICAgICB0aGlzLmdldERPTSgpLm1vZGFsKCdoaWRlJyk7XG4gICAgICAgICAgICB0aGlzLmdldERPTSgpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAvL0ZpeCBtb2RhbC1vcGVuIGNsYXNzIG9uIGJvZHlcbiAgICAgICAgICAgIGRpYWxvZ19vcGVuaW5nID0gTWF0aC5tYXgoMCwgLS1kaWFsb2dfb3BlbmluZyk7XG4gICAgICAgICAgICBqUXVlcnkoJ2JvZHknKS50b2dnbGVDbGFzcygnbW9kYWwtb3BlbicsIGRpYWxvZ19vcGVuaW5nID4gMCk7XG5cbiAgICAgICAgICAgIGlmICghZGlhbG9nX29wZW5pbmcpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkoJ2JvZHkgLm1vZGFsLWJhY2tkcm9wJykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBqUXVlcnkoJyNtb2RhbC1iYWNrZHJvcF8nICsgdGhpcy5pZCkucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFkZExpc3RlbmVyKCdoaWRlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5nZXRET00oKS5oaWRlKCk7XG4gICAgICAgICAgICBqUXVlcnkoJyNtb2RhbC1iYWNrZHJvcF8nICsgdGhpcy5pZCkuaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcignc2hvdycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkuc2hvdygpO1xuICAgICAgICAgICAgalF1ZXJ5KCcjbW9kYWwtYmFja2Ryb3BfJyArIHRoaXMuaWQpLnNob3coKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3VwZGF0ZV9jb250ZW50JywgZnVuY3Rpb24gKG5ld19jb250ZW50KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5nZXREaWFsb2coKS5pc09wZW5lZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDb250ZW50KG5ld19jb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBLaG9haS51dGlsLmluaGVyaXQoQm9vdHN0cmFwLCBUZW1wbGF0ZSk7XG4gICAgS2hvYWkudXRpbC5kZWZpbmVDb25zdGFudChCb290c3RyYXAsICd2ZXJzaW9uJywgdmVyc2lvbik7XG5cbiAgICBCb290c3RyYXAucHJvdG90eXBlLmdldERPTSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRvbSA9IHRoaXMuX3N1cGVyLmdldERPTS5jYWxsKHRoaXMpO1xuICAgICAgICByZXR1cm4galF1ZXJ5KGRvbSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHJldHVybnMge251bGx8KnxPYmplY3R8RXZlbnRFbWl0dGVyfERpYWxvZ31cbiAgICAgKi9cbiAgICBCb290c3RyYXAucHJvdG90eXBlLmdldERpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YVNvdXJjZTtcbiAgICB9O1xuXG4gICAgQm9vdHN0cmFwLnByb3RvdHlwZS51cGRhdGVDb250ZW50ID0gZnVuY3Rpb24gKG5ld19jb250ZW50KSB7XG4gICAgICAgIGlmICghbmV3X2NvbnRlbnQpIHtcbiAgICAgICAgICAgIG5ld19jb250ZW50ID0gdGhpcy5nZXREaWFsb2coKS5vcHRpb25zLmNvbnRlbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBqUXVlcnkodGhpcy5nZXRET00oKSkuZmluZCgnLm1vZGFsLWJvZHknKS5odG1sKG5ld19jb250ZW50KTtcbiAgICB9O1xuXG4gICAgQm9vdHN0cmFwLnByb3RvdHlwZS51cGRhdGVQZW5kaW5nSW5mbyA9IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgIGpRdWVyeSh0aGlzLmdldERPTSgpKS5maW5kKCcuZGlhbG9nLXBlbmRpbmctaW5mbycpLmh0bWwoaW5mbyk7XG4gICAgfTtcblxuXG4gICAgVGVtcGxhdGUucmVnaXN0ZXIoRGlhbG9nLlRFTVBMQVRFX1RZUEUsICdCb290c3RyYXAnLCBCb290c3RyYXApO1xufSkpO1xuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICB2YXIgZGVwZW5kZW5jaWVzID0gW1xuICAgICAgICAgICAgJ2xvZGFzaCcsXG4gICAgICAgICAgICAna2hvYWlqcycsXG4gICAgICAgICAgICAna2hvYWlqcy1wcmUtb3B0aW9ucycsXG4gICAgICAgICAgICAna2hvYWlqcy10ZW1wbGF0ZScsXG4gICAgICAgICAgICAna2hvYWlqcy13YWl0ZXInLFxuICAgICAgICAgICAgJy4uL2RpYWxvZ19idXR0b24nLFxuICAgICAgICAgICAgJy4uL2RpYWxvZydcbiAgICAgICAgXTtcbiAgICAgICAgcmVxdWlyZShkZXBlbmRlbmNpZXMsIGZhY3RvcnkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGZhY3Rvcnkocm9vdC5fLCByb290Lktob2FpLCByb290LlByZU9wdGlvbnMsIHJvb3QuVGVtcGxhdGUsIHJvb3QuV2FpdGVyLCByb290LkRpYWxvZ0J1dHRvbiwgcm9vdC5EaWFsb2cpO1xuICAgIH1cbn0odGhpcywgZnVuY3Rpb24gKF8sIEtob2FpLCBQcmVPcHRpb25zLCBUZW1wbGF0ZSwgV2FpdGVyLCBEaWFsb2dCdXR0b24sIERpYWxvZykge1xuICAgIHZhciB2ZXJzaW9uID0gJzAuMC4xJztcblxuICAgIEtob2FpLnV0aWwuZGVmaW5lQ29uc3RhbnQoRGlhbG9nQnV0dG9uLCB7XG4gICAgICAgIFRFTVBMQVRFX0JPT1RTVFJBUF9QUkVfT1BUSU9OU19OQU1FOiAnS2hvYWkuRGlhbG9nQnV0dG9uLlRlbXBsYXRlLkJvb3RzdHJhcCdcbiAgICB9KTtcblxuICAgIFByZU9wdGlvbnMuZGVmaW5lKERpYWxvZ0J1dHRvbi5URU1QTEFURV9CT09UU1RSQVBfUFJFX09QVElPTlNfTkFNRSwge1xuICAgICAgICBpY29uX2NsYXNzOiAnZGlhbG9nX2J1dHRvbl9pY29uJyxcbiAgICAgICAgbGFiZWxfY2xhc3M6ICdkaWFsb2dfYnV0dG9uX2xhYmVsJ1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gX3NlY3Rpb25faWNvbihpbnN0YW5jZSwgZGF0YV9zb3VyY2UsIGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGFfc291cmNlLm9wdGlvbnMuaWNvbikge1xuICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cIjwlPSBvcHRpb24uaWNvbl9jbGFzcyAlPlwiPjxpIGNsYXNzPVwiPCU9IGRhdGFfc291cmNlLm9wdGlvbnMuaWNvbiAlPlwiPjwvaT48L3NwYW4+Jm5ic3A7Jm5ic3A7JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX2xheW91dChpbnN0YW5jZSwgZGF0YV9zb3VyY2UsIGRhdGEpIHtcbiAgICAgICAgdmFyIHNpemUgPSBfLmNsYW1wKGRhdGFfc291cmNlLm9wdGlvbnMuc2l6ZSAtIDEsIDAsIDQpLFxuICAgICAgICAgICAgcGFkZGluZ19zcGFjZSA9IF8udGltZXMoc2l6ZSAqIDMsIF8uY29uc3RhbnQoJyZuYnNwOyZuYnNwOycpKS5qb2luKCcnKSxcbiAgICAgICAgICAgIHRlbXBsYXRlID0gJycsXG4gICAgICAgICAgICBzdHlsZSA9IFtdO1xuXG4gICAgICAgIGlmICghZGF0YV9zb3VyY2UuaXNWaXNpYmxlKCkpIHtcbiAgICAgICAgICAgIHN0eWxlLnB1c2goJ2Rpc3BsYXk6IG5vbmUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRlbXBsYXRlICs9ICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cIjwlPSBkb21faWQgJT5cIiBkYXRhLWJ1dHRvbi1pZD1cIjwlPSBkYXRhX3NvdXJjZS5pZCAlPlwiJztcbiAgICAgICAgdGVtcGxhdGUgKz0gJ2RhdGEtZHJhdz1cIjwlLSBkcmF3ICU+XCIgc3R5bGU9XCInICsgc3R5bGUuam9pbignOyAnKSArICdcIic7XG4gICAgICAgIHRlbXBsYXRlICs9ICdjbGFzcz1cImJ0biBidG4tPCU9IGRhdGFfc291cmNlLm9wdGlvbnMudHlwZSAlPlwiIGRhdGEtbmFtZT1cIjwlPSBkYXRhX3NvdXJjZS5vcHRpb25zLm5hbWUgJT5cIiAnO1xuICAgICAgICB0ZW1wbGF0ZSArPSAnb25jbGljaz1cIicgKyBpbnN0YW5jZS5jbGlja19rZXkgKyAnKClcIic7XG5cbiAgICAgICAgaWYgKCFkYXRhX3NvdXJjZS5pc0VuYWJsZSgpKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZSArPSAnIGRpc2FibGVkPVwiZGlzYWJsZWRcIic7XG4gICAgICAgIH1cblxuICAgICAgICB0ZW1wbGF0ZSArPSAnPic7XG4gICAgICAgIHRlbXBsYXRlICs9IHBhZGRpbmdfc3BhY2UgKyAnQElDT05AQExBQkVMQCcgKyBwYWRkaW5nX3NwYWNlICsgJzwvYnV0dG9uPic7XG5cbiAgICAgICAgcmV0dXJuIHRlbXBsYXRlO1xuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gQm9vdHN0cmFwKCkge1xuICAgICAgICB0aGlzLnR5cGVfcHJlZml4ID0gJ3RlbXBsYXRlX2RpYWxvZ19idXR0b25fYm9vdHN0cmFwJztcbiAgICAgICAgVGVtcGxhdGUuY2FsbCh0aGlzKTtcblxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgdGhpcy5vcHRpb25zID0gUHJlT3B0aW9ucy5nZXQoRGlhbG9nQnV0dG9uLlRFTVBMQVRFX0JPT1RTVFJBUF9QUkVfT1BUSU9OU19OQU1FKTtcblxuICAgICAgICB0aGlzLnNldExheW91dChfbGF5b3V0KTtcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdJQ09OJywgX3NlY3Rpb25faWNvbi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5zZXRTZWN0aW9uKCdMQUJFTCcsICc8c3BhbiBjbGFzcz1cIjwlPSBvcHRpb24ubGFiZWxfY2xhc3MgJT5cIj48JT0gZGF0YV9zb3VyY2Uub3B0aW9ucy5sYWJlbCAlPjwvc3Bhbj4nKTtcblxuICAgICAgICB0aGlzLmNsaWNrX2tleSA9IFdhaXRlci5jcmVhdGVGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuZ2V0QnV0dG9uKCkuY2xpY2soKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5taW1pYyhbJ3RvZ2dsZScsICd0b2dnbGVfZW5hYmxlJ10pO1xuXG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3RvZ2dsZScsIGZ1bmN0aW9uIChub3RpY2VkX2RhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkudG9nZ2xlKG5vdGljZWRfZGF0YS5kYXRhKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYWRkTGlzdGVuZXIoJ3RvZ2dsZV9lbmFibGUnLCBmdW5jdGlvbiAobm90aWNlZF9kYXRhKSB7XG4gICAgICAgICAgICBpZiAobm90aWNlZF9kYXRhKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRET00oKS5yZW1vdmVBdHRyKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldERPTSgpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuZ2V0RE9NKCkucHJvcCgnZGlzYWJsZWQnLCAhbm90aWNlZF9kYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBLaG9haS51dGlsLmluaGVyaXQoQm9vdHN0cmFwLCBUZW1wbGF0ZSk7XG4gICAgS2hvYWkudXRpbC5kZWZpbmVDb25zdGFudChCb290c3RyYXAsICd2ZXJzaW9uJywgdmVyc2lvbik7XG5cbiAgICBCb290c3RyYXAucHJvdG90eXBlLmdldERPTSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRvbSA9IHRoaXMuX3N1cGVyLmdldERPTS5jYWxsKHRoaXMpO1xuICAgICAgICByZXR1cm4galF1ZXJ5KGRvbSk7XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7bnVsbHwqfE9iamVjdHxFdmVudEVtaXR0ZXJ8RGlhbG9nfVxuICAgICAqL1xuICAgIEJvb3RzdHJhcC5wcm90b3R5cGUuZ2V0QnV0dG9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhU291cmNlO1xuICAgIH07XG5cbiAgICBCb290c3RyYXAucHJvdG90eXBlLnVwZGF0ZUxhYmVsID0gZnVuY3Rpb24gKGxhYmVsKSB7XG4gICAgICAgIHRoaXMuZ2V0RE9NKCkuZmluZCgnLicgKyB0aGlzLm9wdGlvbnMubGFiZWxfY2xhc3MpLmh0bWwobGFiZWwpO1xuICAgIH07XG5cbiAgICBCb290c3RyYXAucHJvdG90eXBlLnVwZGF0ZUljb24gPSBmdW5jdGlvbiAoaWNvbikge1xuXG4gICAgICAgIHRoaXMuZ2V0RE9NKCkuZmluZCgnLicgKyB0aGlzLm9wdGlvbnMuaWNvbl9jbGFzcykuaHRtbCgnPGkgY2xhc3M9XCInICsgaWNvbiArICdcIj48L2k+Jyk7XG4gICAgfTtcblxuXG4gICAgVGVtcGxhdGUucmVnaXN0ZXIoRGlhbG9nQnV0dG9uLlRFTVBMQVRFX1RZUEUsICdCb290c3RyYXAnLCBCb290c3RyYXApO1xufSkpOyJdfQ==
